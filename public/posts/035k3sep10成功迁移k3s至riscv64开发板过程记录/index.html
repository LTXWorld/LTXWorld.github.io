<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½• | LTX&#39;s Blog</title>
<meta name="keywords" content="K3s, RiscV">
<meta name="description" content="å¼•å­
åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹

ç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿
æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬

å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.">
<meta name="author" content="LTX">
<link rel="canonical" href="http://localhost:1313/posts/035k3sep10%E6%88%90%E5%8A%9F%E8%BF%81%E7%A7%BBk3s%E8%87%B3riscv64%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.87ea10c5eb6cdf9fcc27aa5665a12ed25ef08a46de7d411927d891915eb7ca57.css" integrity="sha256-h&#43;oQxets35/MJ6pWZaEu0l7wikbefUEZJ9iRkV63ylc=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.png">
<link rel="mask-icon" href="http://localhost:1313/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="http://localhost:1313/posts/035k3sep10%E6%88%90%E5%8A%9F%E8%BF%81%E7%A7%BBk3s%E8%87%B3riscv64%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<script type="text/javascript"

        async

        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">

MathJax.Hub.Config({

  tex2jax: {

    inlineMath: [['$','$'], ['\\(','\\)']],

    displayMath: [['$$','$$'], ['\[\[','\]\]']],

    processEscapes: true,

    processEnvironments: true,

    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],

    TeX: { equationNumbers: { autoNumber: "AMS" },

         extensions: ["AMSmath.js", "AMSsymbols.js"] }

  }

});


MathJax.Hub.Queue(function() {

    

    

    

    var all = MathJax.Hub.getAllJax(), i;

    for(i = 0; i < all.length; i += 1) {

        all[i].SourceElement().parentNode.className += ' has-jax';

    }

});

</script>


<style>

code.has-jax {

    font: inherit;

    font-size: 100%;

    background: inherit;

    border: inherit;

    color: #515151;

}

</style><meta property="og:url" content="http://localhost:1313/posts/035k3sep10%E6%88%90%E5%8A%9F%E8%BF%81%E7%A7%BBk3s%E8%87%B3riscv64%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/">
  <meta property="og:site_name" content="LTX&#39;s Blog">
  <meta property="og:title" content="K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•">
  <meta property="og:description" content="å¼•å­ åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹
ç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿ æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬ å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-15T13:43:20+08:00">
    <meta property="article:modified_time" content="2025-05-15T13:43:20+08:00">
    <meta property="article:tag" content="K3s">
    <meta property="article:tag" content="RiscV">
      <meta property="og:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png">
<meta name="twitter:title" content="K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•">
<meta name="twitter:description" content="å¼•å­
åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹

ç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿
æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬

å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•",
      "item": "http://localhost:1313/posts/035k3sep10%E6%88%90%E5%8A%9F%E8%BF%81%E7%A7%BBk3s%E8%87%B3riscv64%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•",
  "name": "K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•",
  "description": "å¼•å­ åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹\nç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿ æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬ å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.\n",
  "keywords": [
    "K3s", "RiscV"
  ],
  "articleBody": "å¼•å­ åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹\nç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿ æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬ å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.\nå¯¹äºç¬¬äºŒä»¶äº‹,åœ¨æ“ä½œè¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å¤§å¤§å°å°çš„é—®é¢˜,å…¶å®åœ¨ä¹‹å‰çš„æ–‡ç« æ“ä½œä¸­æˆ‘ä»¬éƒ½é‡åˆ°è¿‡,è¿™é‡Œæ±‡æ€»ä¸€ä¸‹.\næ„å»ºè¿‡ç¨‹ ç”±äº make è¿‡ç¨‹ä¼šæ‰§è¡Œ dapper çš„å®¹å™¨æ„å»º,ä¼šæ¶‰åŠåˆ°ä¸‹è½½,ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜(æˆ‘ä¸å¯èƒ½ç»™å¼€å‘æ¿ä¸Šä»£ç†å§),æ‰€ä»¥æˆ‘ä»¬æ”¾å¼ƒ make è¿‡ç¨‹.\nç›´æ¥é‡‡ç”¨æ‰§è¡Œä¸‰ä¸ªè„šæœ¬çš„æ–¹æ³•,åœ¨æ­¤è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›éƒ¨åˆ†çš„ä»£ç .\né¿å…Golangç‰ˆæœ¬æ£€æµ‹ ç”±äºåœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­,ä¼šå»æ£€æµ‹ å½“å‰ä»£ç ä¸­ k8s çš„ Golang çš„ç‰ˆæœ¬,å…·ä½“ä»£ç åœ¨ /scripts/validate å¦‚ä¸‹:\necho Running: go version if ! go version | grep -s \"go version ${VERSION_GOLANG} \"; then echo \"Unexpected $(go version) - Kubernetes ${VERSION_K8S} should be built with go version ${VERSION_GOLANG}\" exit 1 fi è¿™ä¸ª VERSION_GOLANG æ¥è‡ªäº /scripts/version.sh\nDEPENDENCIES_URL=\"https://raw.githubusercontent.com/kubernetes/kubernetes/${VERSION_K8S}/build/dependencies.yaml\" VERSION_GOLANG=\"go\"$(curl -sL \"${DEPENDENCIES_URL}\" | yq e '.dependencies[] | select(.name == \"golang: upstream version\") æ•…å®ƒä¼šå»ä½¿ç”¨ curl å‘½ä»¤æŸ¥æ‰¾è¿™ä¸ª yaml æ–‡ä»¶,æ¥ç€ yq è¯»å–å…¶ä¸­ golang çš„å­—æ®µ,å…·ä½“å†…å®¹å¦‚ä¸‹:\n# Golang - name: \"golang: upstream version\" version: 1.22.8 refPaths: - path: .go-version - path: build/build-image/cross/VERSION - path: staging/publishing/rules.yaml match: 'default-go-version\\: \\d+.\\d+(alpha|beta|rc)?\\.?(\\d+)?' - path: test/images/Makefile match: GOLANG_VERSION=\\d+.\\d+(alpha|beta|rc)?\\.?\\d+ è€Œè¿™ä¸ªæ£€æŸ¥ golang ç‰ˆæœ¬çš„è¡Œä¸ºä¼šå‡ºç°åœ¨æˆ‘ä»¬è¿è¡Œ k3s çš„è¿‡ç¨‹ä¸­,æºç ä¸­ server å’Œ agent çš„å¯åŠ¨ç¬¬ä¸€æ­¥å°±æ˜¯ cmds.MustValidateGolang()\nä½†æ˜¯,ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜, curl ä¸åŠ¨,ğŸ˜…;å¦‚æœä½ ä¸ç®¡è¿™ä¸ªé—®é¢˜å°±ä¼šå‡ºç°ä»¥ä¸‹ç°è±¡:\nMay 14 18:16:01 revyos-lpi4a k3s[1447]: time=\"2025-05-14T18:16:01+08:00\" level=fatal msg=\"Failed to validate golang version: incorrect golang build version - kubernetes v1.31.2 should be built with go, runtime version is go1.23.6\" å¯ä»¥å‘ç°,should built with goè¿™æ˜¯é”™è¯¯çš„,è‡³å°‘åé¢ä¹Ÿåº”è¯¥æ˜¯ goxxx,è€Œä¸æ˜¯ goâ€”â€”è¯æ˜å…¶æ²¡æœ‰è¯»å–åˆ° yaml æ–‡ä»¶ä¸­çš„å†…å®¹.\nè¿™ä¹Ÿå°±å¯¼è‡´è¿è¡Œ k3s æ—¶ç¬¬ä¸€æ­¥çš„æ£€æŸ¥ç‰ˆæœ¬ä»£ç è¿‡ä¸å»,å³ä¸‹æ–¹è¿™é‡Œçš„ä»£ç : pkg/cli/agent/agent.go\nfunc ValidateGolang() error { k8sVersion, _, _ := strings.Cut(version.Version, \"+\") if version.UpstreamGolang == \"\" { return fmt.Errorf(\"kubernetes golang build version not set - see 'golang: upstream version' in https://github.com/kubernetes/kubernetes/blob/%s/build/dependencies.yaml\", k8sVersion) } if v, _, _ := strings.Cut(runtime.Version(), \" \"); version.UpstreamGolang != v { return fmt.Errorf(\"incorrect golang build version - kubernetes %s should be built with %s, runtime version is %s\", k8sVersion, version.UpstreamGolang, v) } return nil } æ‰€ä»¥æˆ‘ä»¬æœ€åå¹²äº†ä»€ä¹ˆ:\nå°† validate ä¸­å…³äºæ£€éªŒ Golang ç‰ˆæœ¬çš„ä»£ç æ³¨é‡Šæ‰ å°† server ä¸ agent ä¸­çš„ cmds.MustValidateGolang()æ³¨é‡Šæ‰ åœ¨ yaml æ–‡ä»¶ä¸­æ‰¾åˆ°é€‚åˆçš„ golang ç‰ˆæœ¬ä½œä¸ºæˆ‘ä»¬å¼€å‘æ¿ä¸Šè¦ç”¨çš„ç‰ˆæœ¬,è§ä¸Šä¸€ç¯‡æ–‡ç« ç¯å¢ƒé…ç½®. é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢ åœ¨æ‰§è¡Œ download è¿‡ç¨‹ä¸­,å…¶å®å¹¶ä¸éœ€è¦åœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ,è¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­æè¿‡,å…·ä½“åšæ³•å¦‚ä¸‹:\n# åœ¨æˆ‘ä»¬çš„ä¸»æœºä¸Šæ‰§è¡Œ export GOARCH=riscv64 export ARCH=riscv64 export OS=linux ./scripts/download # ç„¶åæ‹·è´buildç›®å½•åˆ°å¼€å‘æ¿çš„k3sæºç ç›®å½•ä¸­ scp build/ root@ip:/root/k3s å¼€å‘æ¿ airgap å®‰è£… åœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ build ä¸ package-cli è„šæœ¬,buildè¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜,é€Ÿåº¦è¾ƒæ…¢,ä½†æ˜¯åªè¦æˆ‘ä»¬çš„ç¯å¢ƒ,å·¥å…·éƒ½æ­£ç¡®,ä¸ä¼šå‡ºç°å…¶ä»–é—®é¢˜.\næ‰§è¡Œå®Œä¸¤ä¸ªè„šæœ¬åä¼šåœ¨ /dist/artifactsç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ª k3s-riscv å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶,å°†ä½œä¸ºæˆ‘ä»¬åç»­å®‰è£…çš„æ–‡ä»¶.\næ¥ç€æˆ‘ä»¬è¿›è¡Œ airgap å®‰è£… server èŠ‚ç‚¹,åˆ©ç”¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„å®‰è£…è„šæœ¬å³å¯å®Œæˆå®‰è£….\nå®‰è£…åæ£€æŸ¥æ˜¯å¦æˆåŠŸ:\nsudo systemctl status k3s sudo kubectl get nodes çœ‹åˆ°è‡ªå·±çš„èŠ‚ç‚¹å³ä¸ºæˆåŠŸ.\næ‰‹åŠ¨æ‹‰å–é•œåƒ åœ¨ 2025-05-14 å®éªŒç‰ˆæœ¬ä¸­,ç³»ç»Ÿé•œåƒå¹¶æ²¡æœ‰è‡ªåŠ¨æ‹‰å–,è¿™ç‚¹æˆ‘ä»¬è¿˜åœ¨å°è¯•,å› ä¸ºå®˜ç½‘è¿˜æœ‰ä¸€ç§ä¸ºå…¶è®¾ç½®é…ç½®æ–‡ä»¶çš„æ–¹å¼ /etc/rancher/k3s/config.yaml\næ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ sudo kubeclt get pods -A æ¥æŸ¥çœ‹è¿™äº›ç³»ç»Ÿé•œåƒ,å¹¶ç”¨sudo kubectl describe pod -n kube-system æ¥æŸ¥çœ‹å…¶é”™è¯¯åŸå› \né”™è¯¯åŸå› å¤§éƒ¨åˆ†éƒ½æ¥è‡ªäºé•œåƒæ‹‰å–å¤±è´¥,å› ä¸ºå®ƒè¿˜åœ¨æ‹‰å–é»˜è®¤çš„ rancher é•œåƒ. æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ registries.yaml æ–‡ä»¶,ä¸ºå…¶æ·»åŠ  rewrite,ä½¿å…¶å°†é»˜è®¤é•œåƒæ”¹ä¸ºæˆ‘ä»¬ç§æœ‰ä»“åº“ä¸­çš„é•œåƒ.\nmirrors: docker.io: endpoint: - \"https://jimlt.bfsmlt.top\" # è¿™é‡Œæ ¹æ®ä¸Š rewrite: \"^library/pause$\": \"pause\" \"^rancher/mirrored-library-traefik$\": \"traefik\" \"^rancher/mirrored-metrics-server$\": \"metrics-server\" \"^rancher/klipper-helm$\": \"klipper-helm\" \"^library/klipper-lb$\": \"klipper-lb\" \"^rancher/local-path-provisioner$\": \"local-path-provisioner\" \"^rancher/mirrored-coredns-coredns$\": \"coredns/coredns\" \"^busybox$\": \"riscv64/busybox\" # æ³¨æ„,å› ä¸ºæˆ‘ä»¬é‡‡ç”¨äº† TLS çš„ç§æœ‰ä»“åº“,æ‰€ä»¥è¿™é‡Œéœ€è¦æ·»åŠ  configs configs: \"jimlt.bfsmlt.top\": # ä½ çš„ç§æœ‰ä»“åº“åœ°å€ auth: username: xxx password: yyyyyyyy ç„¶åéœ€è¦æ‰‹åŠ¨æ‹‰å–è¿™äº›é•œåƒ,åˆ©ç”¨ sudo crictl pull å‘½ä»¤æ‹‰å–. æœ€ç»ˆç»“æœå¦‚ä¸‹:\nsudo kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-56f6fc8fd7-28mn7 1/1 Running 1 (18h ago) 19h kube-system helm-install-traefik-crd-98v8n 0/1 Completed 0 19h kube-system helm-install-traefik-j7czp 0/1 Completed 0 19h kube-system local-path-provisioner-5cf85fd84d-hznms 1/1 Running 0 19h kube-system metrics-server-5985cbc9d7-v7dch 1/1 Running 0 19h kube-system svclb-traefik-699324d1-48lvn 2/2 Running 0 93m kube-system traefik-57b79cf995-xnv79 1/1 Running 0 93m è¿™äº›ç³»ç»Ÿé•œåƒéƒ½å·²ç»åœ¨æˆåŠŸè¿è¡Œ.\næµ‹è¯•pod åœ¨ä¸»æœºä¸Šæ„å»ºä¸€ä¸ªå°çš„é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­å»\npackage main import ( \"fmt\" \"net/http\" \"os\" ) func handler(w http.ResponseWriter, r *http.Request) { message := os.Getenv(\"MESSAGE\") if message == \"\" { message = \"Hello from RISC-V!\" } fmt.Fprintf(w, \"%s\\n\", message) } func main() { http.HandleFunc(\"/\", handler) fmt.Println(\"Listening on :7080\") http.ListenAndServe(\":7080\", nil) } FROM golang:1.22.12-alpine3.20 AS builder WORKDIR /app COPY . . RUN go build -o hello-k8s main.go FROM alpine:latest WORKDIR /root/ COPY --from=builder /app/hello-k8s . EXPOSE 7080 ENTRYPOINT [\"./hello-k8s\"] æ„å»ºå¹¶æ¨é€,æ³¨æ„è®¾ç½® platform ä¸ network\ndocker build --platform=linux/riscv64 --network host -t jimlt.bfsmlt.top/hello-kubernetes:1.0.1 . docker push jimlt.bfsmlt.top/hello-kubernetes:1.0.1 è¿™é‡Œçœ‹ç€ push çš„ç»“æœå¯ä»¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ push çš„æ—¶å€™æ˜¾ç¤º traefik?\nThe push refers to repository [jimlt.bfsmlt.top/hello-kubernetes] f8b25a4c3a38: Pushed ecbb5a20f6d5: Pushed 7df33f7ad8be: Mounted from traefik 4f4fb700ef54: Layer already exists 1.0.1: digest: sha256:78107dc8255d5b7eb09031d1c26fee9b10ee896237ac8b8acc1914e83b704325 size: 857 å› ä¸ºç§æœ‰ä»“åº“ä¸­çš„ traefik é•œåƒå·²ç»æœ‰äº† 7d è¿™ä¸ªé•œåƒå±‚(Docker é•œåƒçš„åŸºæœ¬æ¦‚å¿µ,é•œåƒç”±å±‚ç»„æˆ) æ•…è¿™é‡Œå¤ç”¨äº†è¿™ä¸ªé•œåƒå±‚,å°±ä¸ç”¨å†é‡æ–°æ„å»ºè¿™å±‚äº† åœ¨å¼€å‘æ¿ä¸Šå†™ä¸€ä¸ª hello-deploy.yaml è¿›è¡Œéƒ¨ç½²æµ‹è¯•\napiVersion: v1 kind: Service metadata: name: hello spec: type: ClusterIP ports: - port: 7080 targetPort: 7080 selector: app: hello --- apiVersion: apps/v1 kind: Deployment metadata: name: hello spec: replicas: 1 selector: matchLabels: app: hello template: # æ³¨æ„è¿™é‡Œåœ¨ spec ä¸‹ï¼Œä¸æ˜¯åœ¨ selector ä¸‹ metadata: labels: app: hello spec: containers: - name: hello-kubernetes image: jimlt.bfsmlt.top/hello-kubernetes:1.0.0 env: - name: MESSAGE value: \"Hello RISC-V!\" ports: - containerPort: 7080 è¿è¡Œæ­¤ deployment å¹¶æ‰§è¡Œæµ‹è¯•\nsudo kubectl apply -f hello-deploy.yaml sudo kubectl port-forward svc/hello 7080:7080 curl http://localhost:7080 # è¾“å‡ºç»“æœ Hello RISC-V! æ€»ç»“ è‡³æ­¤,æˆ‘ä»¬çš„ç§»æ¤è¿‡ç¨‹æš‚æ—¶å‘Šä¸€æ®µè½äº†,å¯ä»¥è¿è¡Œèµ·ä¸€ä¸ªç®€å•çš„å°åº”ç”¨,æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå°†å¦ä¸€ä¸ªå¼€å‘æ¿ä½œä¸º agent åŠ å…¥å…¶ä¸­è¿›è¡Œé›†ç¾¤æµ‹è¯•.\nä¸è¿‡å…¶ä¸­å¯¹æºç çš„ä¿®æ”¹æ–¹å¼(é¿å…æ£€æµ‹)ä¹Ÿæ˜¯ä¸€ç§æ— å¥ˆçš„å°è¯•,åç»­çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå…¶ä»–çš„å¥½çš„æ–¹å¼;è¿˜æœ‰æ‰‹åŠ¨æ‹‰å–ç³»ç»Ÿé•œåƒè¿™ä¸€æ­¥ä¹Ÿä¸åº”è¯¥è¿™æ ·åš,å†çœ‹å§.\næœ€åé—®è‡ªå·±ä¸€å¥:é—®é¢˜è§£å†³äº†å—?è¿™é‡Œæ˜¯LTXï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡åšå®¢ï¼Œäººç”Ÿæµ·æµ·ï¼Œå’Œè‡ªå·±å¯¹è¯ï¼Œåƒåªè´è¶çºµæ¨ªå››æµ·ã€‚\n",
  "wordCount" : "1947",
  "inLanguage": "zh",
  "image": "http://localhost:1313/images/papermod-cover.png","datePublished": "2025-05-15T13:43:20+08:00",
  "dateModified": "2025-05-15T13:43:20+08:00",
  "author":{
    "@type": "Person",
    "name": "LTX"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/035k3sep10%E6%88%90%E5%8A%9F%E8%BF%81%E7%A7%BBk3s%E8%87%B3riscv64%E5%BC%80%E5%8F%91%E6%9D%BF%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "LTX's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="LTX&#39;s Blog (Alt + H)">LTX&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/" title="LTX&#39;s Blog">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="æœç´¢">
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="åèŠ±å›­">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      K3sEP10â€”â€”è¿ç§»k3sè‡³riscv64å¼€å‘æ¿çš„è¿‡ç¨‹è®°å½•
    </h1>
    <div class="post-meta"><span title='2025-05-15 13:43:20 +0800 CST'>äº”æœˆ 15, 2025</span>&nbsp;Â·&nbsp;4 åˆ†é’Ÿ&nbsp;Â·&nbsp;LTX

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%bc%95%e5%ad%90" aria-label="å¼•å­">å¼•å­</a></li>
                <li>
                    <a href="#%e6%9e%84%e5%bb%ba%e8%bf%87%e7%a8%8b" aria-label="æ„å»ºè¿‡ç¨‹">æ„å»ºè¿‡ç¨‹</a><ul>
                        
                <li>
                    <a href="#%e9%81%bf%e5%85%8dgolang%e7%89%88%e6%9c%ac%e6%a3%80%e6%b5%8b" aria-label="é¿å…Golangç‰ˆæœ¬æ£€æµ‹">é¿å…Golangç‰ˆæœ¬æ£€æµ‹</a></li>
                <li>
                    <a href="#%e9%81%bf%e5%85%8d%e4%b8%8b%e8%bd%bd%e8%bf%87%e7%a8%8b%e8%bf%87%e6%85%a2" aria-label="é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢">é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢</a></li>
                <li>
                    <a href="#%e5%bc%80%e5%8f%91%e6%9d%bf-airgap-%e5%ae%89%e8%a3%85" aria-label="å¼€å‘æ¿ airgap å®‰è£…">å¼€å‘æ¿ airgap å®‰è£…</a></li>
                <li>
                    <a href="#%e6%89%8b%e5%8a%a8%e6%8b%89%e5%8f%96%e9%95%9c%e5%83%8f" aria-label="æ‰‹åŠ¨æ‹‰å–é•œåƒ">æ‰‹åŠ¨æ‹‰å–é•œåƒ</a></li>
                <li>
                    <a href="#%e6%b5%8b%e8%af%95pod" aria-label="æµ‹è¯•pod">æµ‹è¯•pod</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="å¼•å­">å¼•å­<a hidden class="anchor" aria-hidden="true" href="#å¼•å­">#</a></h2>
<p>åœ¨å‰é¢çš„ä¸€ç³»åˆ—æ–‡ç« ä¸­,æˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åœ¨ riscv å¼€å‘æ¿ä¸Šé€‚é… k3s,æˆ‘ä»¬è¦åšä»¥ä¸‹ä¸¤ä»¶äº‹</p>
<ul>
<li>ç³»ç»Ÿçº§åˆ«çš„é‡è¦é•œåƒè¿›è¡Œé€‚é…å¹¶å¯ä»¥æˆåŠŸæ‹‰å–åˆ°å¼€å‘æ¿</li>
<li>æ‰§è¡Œ make æˆ–è€… download,build,package-cli è„šæœ¬</li>
</ul>
<p>å¯¹äºç¬¬ä¸€ä»¶äº‹,å·²ç»æœ‰äººåšè¿‡äº†,æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ä»–åšå¥½çš„é•œåƒ,å¹¶å°†å…¶æ¨é€åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“.</p>
<p><img alt="support" loading="lazy" src="/img/riscv/support.png"></p>
<p>å¯¹äºç¬¬äºŒä»¶äº‹,åœ¨æ“ä½œè¿‡ç¨‹ä¸­æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°å¤§å¤§å°å°çš„é—®é¢˜,å…¶å®åœ¨ä¹‹å‰çš„æ–‡ç« æ“ä½œä¸­æˆ‘ä»¬éƒ½é‡åˆ°è¿‡,è¿™é‡Œæ±‡æ€»ä¸€ä¸‹.</p>
<h2 id="æ„å»ºè¿‡ç¨‹">æ„å»ºè¿‡ç¨‹<a hidden class="anchor" aria-hidden="true" href="#æ„å»ºè¿‡ç¨‹">#</a></h2>
<p>ç”±äº make è¿‡ç¨‹ä¼šæ‰§è¡Œ dapper çš„å®¹å™¨æ„å»º,ä¼šæ¶‰åŠåˆ°ä¸‹è½½,ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜(æˆ‘ä¸å¯èƒ½ç»™å¼€å‘æ¿ä¸Šä»£ç†å§),æ‰€ä»¥æˆ‘ä»¬æ”¾å¼ƒ make è¿‡ç¨‹.</p>
<p>ç›´æ¥é‡‡ç”¨æ‰§è¡Œä¸‰ä¸ªè„šæœ¬çš„æ–¹æ³•,åœ¨æ­¤è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€äº›éƒ¨åˆ†çš„ä»£ç .</p>
<h3 id="é¿å…golangç‰ˆæœ¬æ£€æµ‹">é¿å…Golangç‰ˆæœ¬æ£€æµ‹<a hidden class="anchor" aria-hidden="true" href="#é¿å…golangç‰ˆæœ¬æ£€æµ‹">#</a></h3>
<p>ç”±äºåœ¨è„šæœ¬æ‰§è¡Œè¿‡ç¨‹ä¸­,ä¼šå»æ£€æµ‹ å½“å‰ä»£ç ä¸­ k8s çš„ Golang çš„ç‰ˆæœ¬,å…·ä½“ä»£ç åœ¨ <code>/scripts/validate</code> å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> Running: go version
</span></span><span class="line"><span class="cl"><span class="k">if</span> ! go version <span class="p">|</span> grep -s <span class="s2">&#34;go version </span><span class="si">${</span><span class="nv">VERSION_GOLANG</span><span class="si">}</span><span class="s2"> &#34;</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">  <span class="nb">echo</span> <span class="s2">&#34;Unexpected </span><span class="k">$(</span>go version<span class="k">)</span><span class="s2"> - Kubernetes </span><span class="si">${</span><span class="nv">VERSION_K8S</span><span class="si">}</span><span class="s2"> should be built with go version </span><span class="si">${</span><span class="nv">VERSION_GOLANG</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span></code></pre></div><p>è¿™ä¸ª VERSION_GOLANG æ¥è‡ªäº <code>/scripts/version.sh</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">DEPENDENCIES_URL</span><span class="o">=</span><span class="s2">&#34;https://raw.githubusercontent.com/kubernetes/kubernetes/</span><span class="si">${</span><span class="nv">VERSION_K8S</span><span class="si">}</span><span class="s2">/build/dependencies.yaml&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">VERSION_GOLANG</span><span class="o">=</span><span class="s2">&#34;go&#34;</span><span class="k">$(</span>curl -sL <span class="s2">&#34;</span><span class="si">${</span><span class="nv">DEPENDENCIES_URL</span><span class="si">}</span><span class="s2">&#34;</span> <span class="p">|</span> yq e <span class="err">&#39;</span>.dependencies<span class="o">[]</span> <span class="p">|</span> <span class="k">select</span><span class="o">(</span>.name <span class="o">==</span> <span class="s2">&#34;golang: upstream version&#34;</span><span class="k">)</span>
</span></span></code></pre></div><p>æ•…å®ƒä¼šå»ä½¿ç”¨ curl å‘½ä»¤æŸ¥æ‰¾è¿™ä¸ª yaml æ–‡ä»¶,æ¥ç€ yq è¯»å–å…¶ä¸­ golang çš„å­—æ®µ,å…·ä½“å†…å®¹å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Golang</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;golang: upstream version&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">1.22.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">refPaths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">.go-version</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">build/build-image/cross/VERSION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">staging/publishing/rules.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">match: &#39;default-go-version\</span><span class="p">:</span><span class="w"> </span><span class="l">\d+.\d+(alpha|beta|rc)?\.?(\d+)?&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">test/images/Makefile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">match</span><span class="p">:</span><span class="w"> </span><span class="l">GOLANG_VERSION=\d+.\d+(alpha|beta|rc)?\.?\d+</span><span class="w">
</span></span></span></code></pre></div><p>è€Œè¿™ä¸ªæ£€æŸ¥ golang ç‰ˆæœ¬çš„è¡Œä¸ºä¼šå‡ºç°åœ¨æˆ‘ä»¬è¿è¡Œ k3s çš„è¿‡ç¨‹ä¸­,æºç ä¸­ server å’Œ agent çš„å¯åŠ¨ç¬¬ä¸€æ­¥å°±æ˜¯ <code>cmds.MustValidateGolang()</code></p>
<p>ä½†æ˜¯,ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œé—®é¢˜, curl ä¸åŠ¨,ğŸ˜…;å¦‚æœä½ ä¸ç®¡è¿™ä¸ªé—®é¢˜å°±ä¼šå‡ºç°ä»¥ä¸‹ç°è±¡:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">May <span class="m">14</span> 18:16:01 revyos-lpi4a k3s<span class="o">[</span>1447<span class="o">]</span>: <span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2025-05-14T18:16:01+08:00&#34;</span> <span class="nv">level</span><span class="o">=</span>fatal <span class="nv">msg</span><span class="o">=</span><span class="s2">&#34;Failed to validate golang version: incorrect golang build version - kubernetes v1.31.2 should be built with go, runtime version is go1.23.6&#34;</span>
</span></span></code></pre></div><p>å¯ä»¥å‘ç°,<code>should built with go</code>è¿™æ˜¯é”™è¯¯çš„,è‡³å°‘åé¢ä¹Ÿåº”è¯¥æ˜¯ goxxx,è€Œä¸æ˜¯ goâ€”â€”è¯æ˜å…¶æ²¡æœ‰è¯»å–åˆ° yaml æ–‡ä»¶ä¸­çš„å†…å®¹.</p>
<p>è¿™ä¹Ÿå°±å¯¼è‡´è¿è¡Œ k3s æ—¶ç¬¬ä¸€æ­¥çš„æ£€æŸ¥ç‰ˆæœ¬ä»£ç è¿‡ä¸å»,å³ä¸‹æ–¹è¿™é‡Œçš„ä»£ç : <code>pkg/cli/agent/agent.go</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">ValidateGolang</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">k8sVersion</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Cut</span><span class="p">(</span><span class="nx">version</span><span class="p">.</span><span class="nx">Version</span><span class="p">,</span> <span class="s">&#34;+&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">version</span><span class="p">.</span><span class="nx">UpstreamGolang</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;kubernetes golang build version not set - see &#39;golang: upstream version&#39; in https://github.com/kubernetes/kubernetes/blob/%s/build/dependencies.yaml&#34;</span><span class="p">,</span> <span class="nx">k8sVersion</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Cut</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nf">Version</span><span class="p">(),</span> <span class="s">&#34; &#34;</span><span class="p">);</span> <span class="nx">version</span><span class="p">.</span><span class="nx">UpstreamGolang</span> <span class="o">!=</span> <span class="nx">v</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;incorrect golang build version - kubernetes %s should be built with %s, runtime version is %s&#34;</span><span class="p">,</span> <span class="nx">k8sVersion</span><span class="p">,</span> <span class="nx">version</span><span class="p">.</span><span class="nx">UpstreamGolang</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬æœ€åå¹²äº†ä»€ä¹ˆ:</p>
<ul>
<li>å°† validate ä¸­å…³äºæ£€éªŒ Golang ç‰ˆæœ¬çš„ä»£ç æ³¨é‡Šæ‰</li>
<li>å°† server ä¸ agent ä¸­çš„ <code>cmds.MustValidateGolang()</code>æ³¨é‡Šæ‰</li>
<li>åœ¨ yaml æ–‡ä»¶ä¸­æ‰¾åˆ°é€‚åˆçš„ golang ç‰ˆæœ¬ä½œä¸ºæˆ‘ä»¬å¼€å‘æ¿ä¸Šè¦ç”¨çš„ç‰ˆæœ¬,è§ä¸Šä¸€ç¯‡æ–‡ç« ç¯å¢ƒé…ç½®.</li>
</ul>
<h3 id="é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢">é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢<a hidden class="anchor" aria-hidden="true" href="#é¿å…ä¸‹è½½è¿‡ç¨‹è¿‡æ…¢">#</a></h3>
<p>åœ¨æ‰§è¡Œ download è¿‡ç¨‹ä¸­,å…¶å®å¹¶ä¸éœ€è¦åœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ,è¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨<a href="https://www.bfsmlt.top/posts/023k3sep06%E4%BB%8Eissues%E4%B8%8A%E5%BE%97%E5%88%B0%E7%9A%84%E5%8F%AF%E8%83%BD%E5%B0%9D%E8%AF%95/#download%E9%81%87%E5%88%B0%E7%BD%91%E7%BB%9C%E9%97%AE%E9%A2%98">è¿™ç¯‡æ–‡ç« </a>ä¸­æè¿‡,å…·ä½“åšæ³•å¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åœ¨æˆ‘ä»¬çš„ä¸»æœºä¸Šæ‰§è¡Œ</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">GOARCH</span><span class="o">=</span>riscv64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">ARCH</span><span class="o">=</span>riscv64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">OS</span><span class="o">=</span>linux
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./scripts/download
</span></span><span class="line"><span class="cl"><span class="c1"># ç„¶åæ‹·è´buildç›®å½•åˆ°å¼€å‘æ¿çš„k3sæºç ç›®å½•ä¸­</span>
</span></span><span class="line"><span class="cl">scp build/ root@ip:/root/k3s
</span></span></code></pre></div><h3 id="å¼€å‘æ¿-airgap-å®‰è£…">å¼€å‘æ¿ airgap å®‰è£…<a hidden class="anchor" aria-hidden="true" href="#å¼€å‘æ¿-airgap-å®‰è£…">#</a></h3>
<p>åœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ build ä¸ package-cli è„šæœ¬,buildè¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ç½‘ç»œé—®é¢˜,é€Ÿåº¦è¾ƒæ…¢,ä½†æ˜¯åªè¦æˆ‘ä»¬çš„ç¯å¢ƒ,å·¥å…·éƒ½æ­£ç¡®,ä¸ä¼šå‡ºç°å…¶ä»–é—®é¢˜.</p>
<p>æ‰§è¡Œå®Œä¸¤ä¸ªè„šæœ¬åä¼šåœ¨ <code>/dist/artifacts</code>ç›®å½•ä¸‹äº§ç”Ÿä¸€ä¸ª k3s-riscv å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶,å°†ä½œä¸ºæˆ‘ä»¬åç»­å®‰è£…çš„æ–‡ä»¶.</p>
<p>æ¥ç€æˆ‘ä»¬è¿›è¡Œ <a href="https://docs.k3s.io/zh/installation/airgap">airgap</a> å®‰è£… server èŠ‚ç‚¹,åˆ©ç”¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„å®‰è£…è„šæœ¬å³å¯å®Œæˆå®‰è£….</p>
<p>å®‰è£…åæ£€æŸ¥æ˜¯å¦æˆåŠŸ:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl status k3s
</span></span><span class="line"><span class="cl">sudo kubectl get nodes
</span></span></code></pre></div><p>çœ‹åˆ°è‡ªå·±çš„èŠ‚ç‚¹å³ä¸ºæˆåŠŸ.</p>
<h3 id="æ‰‹åŠ¨æ‹‰å–é•œåƒ">æ‰‹åŠ¨æ‹‰å–é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#æ‰‹åŠ¨æ‹‰å–é•œåƒ">#</a></h3>
<p>åœ¨ 2025-05-14 å®éªŒç‰ˆæœ¬ä¸­,ç³»ç»Ÿé•œåƒå¹¶æ²¡æœ‰è‡ªåŠ¨æ‹‰å–,è¿™ç‚¹æˆ‘ä»¬è¿˜åœ¨å°è¯•,å› ä¸ºå®˜ç½‘è¿˜æœ‰ä¸€ç§ä¸ºå…¶è®¾ç½®é…ç½®æ–‡ä»¶çš„æ–¹å¼ <code>/etc/rancher/k3s/config.yaml</code></p>
<p>æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>sudo kubeclt get pods -A</code> æ¥æŸ¥çœ‹è¿™äº›ç³»ç»Ÿé•œåƒ,å¹¶ç”¨<code>sudo kubectl describe pod &lt;podName&gt; -n kube-system</code> æ¥æŸ¥çœ‹å…¶é”™è¯¯åŸå› </p>
<p>é”™è¯¯åŸå› å¤§éƒ¨åˆ†éƒ½æ¥è‡ªäºé•œåƒæ‹‰å–å¤±è´¥,å› ä¸ºå®ƒè¿˜åœ¨æ‹‰å–é»˜è®¤çš„ rancher é•œåƒ.
æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ registries.yaml æ–‡ä»¶,ä¸ºå…¶æ·»åŠ  rewrite,ä½¿å…¶å°†é»˜è®¤é•œåƒæ”¹ä¸ºæˆ‘ä»¬ç§æœ‰ä»“åº“ä¸­çš„é•œåƒ.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">mirrors</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">docker.io</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;https://jimlt.bfsmlt.top&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># è¿™é‡Œæ ¹æ®ä¸Š</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rewrite</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^library/pause$&#34;: </span><span class="s2">&#34;pause&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^rancher/mirrored-library-traefik$&#34;: </span><span class="s2">&#34;traefik&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^rancher/mirrored-metrics-server$&#34;: </span><span class="s2">&#34;metrics-server&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^rancher/klipper-helm$&#34;: </span><span class="s2">&#34;klipper-helm&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^library/klipper-lb$&#34;: </span><span class="s2">&#34;klipper-lb&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^rancher/local-path-provisioner$&#34;: </span><span class="s2">&#34;local-path-provisioner&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^rancher/mirrored-coredns-coredns$&#34;: </span><span class="s2">&#34;coredns/coredns&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^busybox$&#34;: </span><span class="s2">&#34;riscv64/busybox&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># æ³¨æ„,å› ä¸ºæˆ‘ä»¬é‡‡ç”¨äº† TLS çš„ç§æœ‰ä»“åº“,æ‰€ä»¥è¿™é‡Œéœ€è¦æ·»åŠ  configs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">configs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#34;jimlt.bfsmlt.top&#34;: </span><span class="c"># ä½ çš„ç§æœ‰ä»“åº“åœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">auth</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">xxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">yyyyyyyy</span><span class="w">
</span></span></span></code></pre></div><p>ç„¶åéœ€è¦æ‰‹åŠ¨æ‹‰å–è¿™äº›é•œåƒ,åˆ©ç”¨ <code>sudo crictl pull</code> å‘½ä»¤æ‹‰å–.
æœ€ç»ˆç»“æœå¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo kubectl get pods -A
</span></span><span class="line"><span class="cl">NAMESPACE     NAME                                      READY   STATUS      RESTARTS      AGE
</span></span><span class="line"><span class="cl">kube-system   coredns-56f6fc8fd7-28mn7                  1/1     Running     <span class="m">1</span> <span class="o">(</span>18h ago<span class="o">)</span>   19h
</span></span><span class="line"><span class="cl">kube-system   helm-install-traefik-crd-98v8n            0/1     Completed   <span class="m">0</span>             19h
</span></span><span class="line"><span class="cl">kube-system   helm-install-traefik-j7czp                0/1     Completed   <span class="m">0</span>             19h
</span></span><span class="line"><span class="cl">kube-system   local-path-provisioner-5cf85fd84d-hznms   1/1     Running     <span class="m">0</span>             19h
</span></span><span class="line"><span class="cl">kube-system   metrics-server-5985cbc9d7-v7dch           1/1     Running     <span class="m">0</span>             19h
</span></span><span class="line"><span class="cl">kube-system   svclb-traefik-699324d1-48lvn              2/2     Running     <span class="m">0</span>             93m
</span></span><span class="line"><span class="cl">kube-system   traefik-57b79cf995-xnv79                  1/1     Running     <span class="m">0</span>             93m
</span></span></code></pre></div><p>è¿™äº›ç³»ç»Ÿé•œåƒéƒ½å·²ç»åœ¨æˆåŠŸè¿è¡Œ.</p>
<h3 id="æµ‹è¯•pod">æµ‹è¯•pod<a hidden class="anchor" aria-hidden="true" href="#æµ‹è¯•pod">#</a></h3>
<p>åœ¨ä¸»æœºä¸Šæ„å»ºä¸€ä¸ªå°çš„é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­å»</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;net/http&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">message</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;MESSAGE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">message</span> <span class="o">==</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">message</span> <span class="p">=</span> <span class="s">&#34;Hello from RISC-V!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;%s\n&#34;</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Listening on :7080&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:7080&#34;</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> golang:1.22.12-alpine3.20 AS builder</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> . .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> go build -o hello-k8s main.go<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /root/</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder /app/hello-k8s .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 7080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&#34;./hello-k8s&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>æ„å»ºå¹¶æ¨é€,æ³¨æ„è®¾ç½® platform ä¸ network</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build --platform<span class="o">=</span>linux/riscv64 --network host -t jimlt.bfsmlt.top/hello-kubernetes:1.0.1 .
</span></span><span class="line"><span class="cl">docker push jimlt.bfsmlt.top/hello-kubernetes:1.0.1
</span></span></code></pre></div><p>è¿™é‡Œçœ‹ç€ push çš„ç»“æœå¯ä»¥æ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ push çš„æ—¶å€™æ˜¾ç¤º traefik?</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">The push refers to repository <span class="o">[</span>jimlt.bfsmlt.top/hello-kubernetes<span class="o">]</span>
</span></span><span class="line"><span class="cl">f8b25a4c3a38: Pushed
</span></span><span class="line"><span class="cl">ecbb5a20f6d5: Pushed
</span></span><span class="line"><span class="cl">7df33f7ad8be: Mounted from traefik
</span></span><span class="line"><span class="cl">4f4fb700ef54: Layer already exists
</span></span><span class="line"><span class="cl">1.0.1: digest: sha256:78107dc8255d5b7eb09031d1c26fee9b10ee896237ac8b8acc1914e83b704325 size: <span class="m">857</span>
</span></span></code></pre></div><ul>
<li>å› ä¸ºç§æœ‰ä»“åº“ä¸­çš„ traefik é•œåƒå·²ç»æœ‰äº† 7d è¿™ä¸ªé•œåƒå±‚(Docker é•œåƒçš„åŸºæœ¬æ¦‚å¿µ,é•œåƒç”±å±‚ç»„æˆ)</li>
<li>æ•…è¿™é‡Œå¤ç”¨äº†è¿™ä¸ªé•œåƒå±‚,å°±ä¸ç”¨å†é‡æ–°æ„å»ºè¿™å±‚äº†</li>
</ul>
<p>åœ¨å¼€å‘æ¿ä¸Šå†™ä¸€ä¸ª hello-deploy.yaml è¿›è¡Œéƒ¨ç½²æµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterIP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">7080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">  </span><span class="c"># æ³¨æ„è¿™é‡Œåœ¨ spec ä¸‹ï¼Œä¸æ˜¯åœ¨ selector ä¸‹</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">hello</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">hello-kubernetes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">jimlt.bfsmlt.top/hello-kubernetes:1.0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MESSAGE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Hello RISC-V!&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">7080</span><span class="w">
</span></span></span></code></pre></div><p>è¿è¡Œæ­¤ deployment å¹¶æ‰§è¡Œæµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo kubectl apply -f hello-deploy.yaml
</span></span><span class="line"><span class="cl">sudo kubectl port-forward svc/hello 7080:7080
</span></span><span class="line"><span class="cl">curl http://localhost:7080
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºç»“æœ</span>
</span></span><span class="line"><span class="cl">Hello RISC-V!
</span></span></code></pre></div><h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>è‡³æ­¤,æˆ‘ä»¬çš„ç§»æ¤è¿‡ç¨‹æš‚æ—¶å‘Šä¸€æ®µè½äº†,å¯ä»¥è¿è¡Œèµ·ä¸€ä¸ªç®€å•çš„å°åº”ç”¨,æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå°†å¦ä¸€ä¸ªå¼€å‘æ¿ä½œä¸º agent åŠ å…¥å…¶ä¸­è¿›è¡Œé›†ç¾¤æµ‹è¯•.</p>
<p>ä¸è¿‡å…¶ä¸­å¯¹æºç çš„ä¿®æ”¹æ–¹å¼(é¿å…æ£€æµ‹)ä¹Ÿæ˜¯ä¸€ç§æ— å¥ˆçš„å°è¯•,åç»­çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå…¶ä»–çš„å¥½çš„æ–¹å¼;è¿˜æœ‰æ‰‹åŠ¨æ‹‰å–ç³»ç»Ÿé•œåƒè¿™ä¸€æ­¥ä¹Ÿä¸åº”è¯¥è¿™æ ·åš,å†çœ‹å§.</p>
<p>æœ€åé—®è‡ªå·±ä¸€å¥:é—®é¢˜è§£å†³äº†å—?<strong>è¿™é‡Œæ˜¯LTXï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡åšå®¢ï¼Œäººç”Ÿæµ·æµ·ï¼Œå’Œè‡ªå·±å¯¹è¯ï¼Œåƒåªè´è¶çºµæ¨ªå››æµ·ã€‚</strong></p>
<p><img alt="2" loading="lazy" src="/img/shu/%E8%BA%BA%E5%B9%B3.webp"></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/k3s/">K3s</a></li>
      <li><a href="http://localhost:1313/tags/riscv/">RiscV</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/036k3sep11%E5%8A%A0%E5%85%A5agent%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E9%9B%86%E7%BE%A4%E6%B5%8B%E8%AF%95/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>K3sEP11â€”â€”åŠ å…¥agentèŠ‚ç‚¹è¿›è¡Œé›†ç¾¤æµ‹è¯•</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/034k3sep09%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E6%9D%BF%E7%8E%AF%E5%A2%83%E6%B1%87%E6%80%BB/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>K3sEP09â€”â€”åˆå§‹åŒ–å¼€å‘æ¿ç¯å¢ƒæ“ä½œæ±‡æ€»</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>

<script>

    

    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";

    const setGiscusTheme = () => {

        const sendMessage = (message) => {

            const iframe = document.querySelector('iframe.giscus-frame');

            if (iframe) {

                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');

            }

        }

        sendMessage({setConfig: {theme: getStoredTheme()}})

    }


    document.addEventListener("DOMContentLoaded", () => {

        const giscusAttributes = {

            "src": "https://giscus.app/client.js",

            "data-repo": "LTXWorld\/LTXWorld.github.io",

            "data-repo-id": "R_kgDONODUuA",

            "data-category": "Announcements",

            "data-category-id": "DIC_kwDONODUuM4CkMUw",

            "data-mapping": "pathname",

            "data-strict": "0",

            "data-reactions-enabled": "1",

            "data-emit-metadata": "0",

            "data-input-position": "bottom",

            "data-theme": getStoredTheme(),

            "data-lang": "zh-CN",

            "data-loading": "lazy",

            "crossorigin": "anonymous",

        };


        

        const giscusScript = document.createElement("script");

        Object.entries(giscusAttributes).forEach(

                ([key, value]) => giscusScript.setAttribute(key, value));

        document.querySelector("#tw-comment").appendChild(giscusScript);


        

        const themeSwitcher = document.querySelector("#theme-toggle");

        if (themeSwitcher) {

            themeSwitcher.addEventListener("click", setGiscusTheme);

        }

        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");

        if (themeFloatSwitcher) {

            themeFloatSwitcher.addEventListener("click", setGiscusTheme);

        }

    });

</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://LTXWorld.github.io/">Â©2025 LTX&rsquo;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div class="ltx-music-player" id="ltx-music-player" role="group" aria-label="èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨">
  <audio id="ltx-music-audio" preload="metadata"></audio>
  <div class="ltx-music-meta">
    <span class="ltx-music-title" data-role="title"></span>
    <span class="ltx-music-artist" data-role="artist"></span>
  </div>
  <div class="ltx-music-progress" data-role="progress" aria-label="è¿›åº¦æ¡" role="slider">
    <div class="ltx-music-progress-fill" data-role="progress-fill"></div>
  </div>
  <div class="ltx-music-time">
    <span data-role="current">0:00</span>
    <span data-role="total">--:--</span>
  </div>
  <div class="ltx-music-controls">
    <button type="button" data-action="prev" aria-label="ä¸Šä¸€é¦–">â®</button>
    <button type="button" data-action="toggle" aria-label="æ’­æ”¾æˆ–æš‚åœ">
      <span data-icon="play">â–¶</span>
      <span data-icon="pause">â¸</span>
    </button>
    <button type="button" data-action="next" aria-label="ä¸‹ä¸€é¦–">â­</button>
    <button type="button" data-action="mute" aria-label="é™éŸ³æˆ–å–æ¶ˆé™éŸ³">
      <span data-icon="unmuted">ğŸ”Š</span>
      <span data-icon="muted">ğŸ”‡</span>
    </button>
  </div>
  <div class="ltx-autoplay-tip" data-role="tip" aria-live="polite"></div>
</div>
<script>
  window.LTX_MUSIC_CONFIG = {"autoplay":true,"loopPlaylist":true,"startVolume":0.6,"tracks":[{"artist":"ç‹åŠ›å®","file":"/audio/02 - ä¾ç„¶çˆ±ä½ .mp3","title":"ä¾ç„¶çˆ±ä½ "},{"artist":"ç‹åŠ›å®","file":"/audio/05 - æ”¹å˜è‡ªå·±.mp3","title":"æ”¹å˜è‡ªå·±"},{"artist":"ç‹åŠ›å®","file":"/audio/11 - çˆ±é”™.mp3","title":"çˆ±é”™"}]};
  (function () {
    const config = window.LTX_MUSIC_CONFIG || {};
    if (!config.tracks || !config.tracks.length) {
      return;
    }

    const player = document.getElementById('ltx-music-player');
    const audio = player.querySelector('audio');
    const titleEl = player.querySelector('[data-role="title"]');
    const artistEl = player.querySelector('[data-role="artist"]');
    const progressEl = player.querySelector('[data-role="progress"]');
    const progressFillEl = player.querySelector('[data-role="progress-fill"]');
    const currentTimeEl = player.querySelector('[data-role="current"]');
    const totalTimeEl = player.querySelector('[data-role="total"]');
    const tipEl = player.querySelector('[data-role="tip"]');

    const toggleBtn = player.querySelector('[data-action="toggle"]');
    const prevBtn = player.querySelector('[data-action="prev"]');
    const nextBtn = player.querySelector('[data-action="next"]');
    const muteBtn = player.querySelector('[data-action="mute"]');

    const clamp = (value, min, max) => Math.min(Math.max(value, min), max);
    const formatTime = (seconds) => {
      if (!Number.isFinite(seconds)) {
        return '--:--';
      }
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${String(mins).padStart(1, '0')}:${String(secs).padStart(2, '0')}`;
    };

    const state = {
      index: 0,
      tracks: config.tracks,
      autoplay: config.autoplay !== false,
      loopPlaylist: config.loopPlaylist !== false,
    };

    const updateMuteClass = () => {
      const muted = audio.muted || audio.volume === 0;
      player.classList.toggle('ltx-muted', muted);
    };

    audio.volume = clamp(config.startVolume ?? 0.6, 0, 1);
    updateMuteClass();

    const updateProgress = () => {
      const duration = audio.duration || 0;
      const current = audio.currentTime || 0;
      const percentage = duration ? (current / duration) * 100 : 0;
      progressFillEl.style.width = `${percentage}%`;
      currentTimeEl.textContent = formatTime(current);
      totalTimeEl.textContent = formatTime(duration);
    };

    const setTrack = (nextIndex, options = {}) => {
      const total = state.tracks.length;
      state.index = ((nextIndex % total) + total) % total;
      const track = state.tracks[state.index];
      if (!track || !track.file) {
        console.warn('LTX music player: éŸ³é¢‘æ–‡ä»¶ç¼ºå¤±', track);
        tipEl.textContent = 'éŸ³é¢‘æ–‡ä»¶ç¼ºå¤±ï¼Œè¯·æ£€æŸ¥é…ç½®';
        return;
      }
      titleEl.textContent = track.title || `Track ${state.index + 1}`;
      artistEl.textContent = track.artist || '';
      audio.src = track.file;
      player.dataset.trackIndex = state.index;
      tipEl.textContent = '';
      player.classList.remove('ltx-autoplay-blocked');
      updateProgress();
      if (options.play) {
        attemptPlay();
      }
    };

    const attemptPlay = () => {
      audio.play().then(() => {
        player.classList.remove('ltx-autoplay-blocked');
        tipEl.textContent = '';
      }).catch(() => {
        player.classList.add('ltx-autoplay-blocked');
        tipEl.textContent = 'æµè§ˆå™¨é˜»æ­¢äº†è‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®';
      });
    };

    const playNext = (autoTriggered = false) => {
      const shouldPlay = !audio.paused || autoTriggered;
      const nextIndex = state.index + 1;
      if (nextIndex >= state.tracks.length && !state.loopPlaylist) {
        audio.currentTime = audio.duration || 0;
        audio.pause();
        return;
      }
      setTrack(nextIndex, { play: shouldPlay });
    };

    const playPrev = () => {
      const shouldPlay = !audio.paused;
      setTrack(state.index - 1, { play: shouldPlay });
    };

    toggleBtn.addEventListener('click', () => {
      if (audio.paused) {
        attemptPlay();
      } else {
        audio.pause();
      }
    });

    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', () => playNext(false));

    muteBtn.addEventListener('click', () => {
      audio.muted = !audio.muted;
      updateMuteClass();
    });

    progressEl.addEventListener('click', (event) => {
      const rect = progressEl.getBoundingClientRect();
      const ratio = clamp((event.clientX - rect.left) / rect.width, 0, 1);
      if (Number.isFinite(audio.duration)) {
        audio.currentTime = ratio * audio.duration;
      }
    });

    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('loadedmetadata', updateProgress);

    audio.addEventListener('play', () => {
      player.classList.add('ltx-playing');
      player.classList.remove('ltx-autoplay-blocked');
      tipEl.textContent = '';
    });

    audio.addEventListener('pause', () => {
      player.classList.remove('ltx-playing');
    });

    audio.addEventListener('ended', () => {
      playNext(true);
    });

    audio.addEventListener('volumechange', updateMuteClass);

    setTrack(0, { play: state.autoplay });
  })();
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
