<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿ | LTX&#39;s Blog</title>
<meta name="keywords" content="Docker, Macos, RiscV">
<meta name="description" content="å¼•å­
äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚riscv64/nginx,riscv64/redisç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚
æ‹¿nginxé•œåƒä¸¾ä¾‹:">
<meta name="author" content="LTX">
<link rel="canonical" href="https://LTXWorld.github.io/posts/016k3sep03%E7%A7%BB%E6%A4%8D%E9%95%9C%E5%83%8F%E5%88%B0riscv%E5%BC%80%E5%8F%91%E6%9D%BF/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.dddcf8236b9dfa07cf7fc41c31965e89e4a220be850d3a2a97c6101480c078a9.css" integrity="sha256-3dz4I2ud&#43;gfPf8QcMZZeieSiIL6FDToql8YQFIDAeKk=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://LTXWorld.github.io/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://LTXWorld.github.io/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://LTXWorld.github.io/favicon.png">
<link rel="apple-touch-icon" href="https://LTXWorld.github.io/favicon.png">
<link rel="mask-icon" href="https://LTXWorld.github.io/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://LTXWorld.github.io/posts/016k3sep03%E7%A7%BB%E6%A4%8D%E9%95%9C%E5%83%8F%E5%88%B0riscv%E5%BC%80%E5%8F%91%E6%9D%BF/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
<script type="text/javascript"

        async

        src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML">

MathJax.Hub.Config({

  tex2jax: {

    inlineMath: [['$','$'], ['\\(','\\)']],

    displayMath: [['$$','$$'], ['\[\[','\]\]']],

    processEscapes: true,

    processEnvironments: true,

    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],

    TeX: { equationNumbers: { autoNumber: "AMS" },

         extensions: ["AMSmath.js", "AMSsymbols.js"] }

  }

});


MathJax.Hub.Queue(function() {

    

    

    

    var all = MathJax.Hub.getAllJax(), i;

    for(i = 0; i < all.length; i += 1) {

        all[i].SourceElement().parentNode.className += ' has-jax';

    }

});

</script>


<style>

code.has-jax {

    font: inherit;

    font-size: 100%;

    background: inherit;

    border: inherit;

    color: #515151;

}

</style><meta property="og:url" content="https://LTXWorld.github.io/posts/016k3sep03%E7%A7%BB%E6%A4%8D%E9%95%9C%E5%83%8F%E5%88%B0riscv%E5%BC%80%E5%8F%91%E6%9D%BF/">
  <meta property="og:site_name" content="LTX&#39;s Blog">
  <meta property="og:title" content="K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿">
  <meta property="og:description" content="å¼•å­ äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚riscv64/nginx,riscv64/redisç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚ æ‹¿nginxé•œåƒä¸¾ä¾‹:">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-04-02T19:10:13+08:00">
    <meta property="article:modified_time" content="2025-04-02T19:10:13+08:00">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Macos">
    <meta property="article:tag" content="RiscV">
      <meta property="og:image" content="https://LTXWorld.github.io/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://LTXWorld.github.io/images/papermod-cover.png">
<meta name="twitter:title" content="K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿">
<meta name="twitter:description" content="å¼•å­
äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚riscv64/nginx,riscv64/redisç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚
æ‹¿nginxé•œåƒä¸¾ä¾‹:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://LTXWorld.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿",
      "item": "https://LTXWorld.github.io/posts/016k3sep03%E7%A7%BB%E6%A4%8D%E9%95%9C%E5%83%8F%E5%88%B0riscv%E5%BC%80%E5%8F%91%E6%9D%BF/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿",
  "name": "K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿",
  "description": "å¼•å­ äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚riscv64/nginx,riscv64/redisç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚ æ‹¿nginxé•œåƒä¸¾ä¾‹:\n",
  "keywords": [
    "Docker", "Macos", "RiscV"
  ],
  "articleBody": "å¼•å­ äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚riscv64/nginx,riscv64/redisç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚ æ‹¿nginxé•œåƒä¸¾ä¾‹:\ndocker search riscv64/nginx\næ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„é•œåƒ\nriscv64/nginx Official build of Nginx. 0 nginx/nginx-ingress NGINX and NGINX Plus Ingress Controllers foâ€¦ 102 nginx/nginx-prometheus-exporter NGINX Prometheus Exporter for NGINX and NGINâ€¦ 49 nginx/nginx-ingress-operator NGINX Ingress Operator for NGINX and NGINX Pâ€¦ 2 nginx/unit This repository is retired, use the Docker oâ€¦ 65 nginx/nginx-quic-qns NGINX QUIC interop 1 nginxproxy/nginx-proxy Automated nginx proxy for Docker containers â€¦ 161 nginx Official build of Nginx. 20719 [OK] å¯ä»¥å‘ç°riscv64/nginxçš„Starsæ•°é‡ä¸º0ï¼Œä¹Ÿä¸æ˜¯å®˜æ–¹é•œåƒï¼Œæ‰€ä»¥æ‹‰å–å¤±è´¥ã€‚ï¼ˆå³ä½¿ä½¿ç”¨ä»£ç†åœ°å€ï¼Œå¼€å‘æ¿ä¸Šä¹Ÿä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå› ä¸ºä»£ç†åœ°å€ä¸­ä¹Ÿæ²¡ä¿å­˜éå®˜æ–¹çš„é•œåƒï¼‰\nç”±æ­¤å¯è§ï¼Œè‡ªè¡Œæ„å»ºåˆé€‚çš„é•œåƒè¿«åœ¨çœ‰ç«ã€‚\nç§æœ‰é•œåƒä»“åº“ Dockerä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ„å»ºç§æœ‰é•œåƒä»“åº“çš„èƒ½åŠ›ï¼Œåˆ©ç”¨å…¶registryé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æ­å»ºä¸€ä¸ªç§äººçš„é•œåƒä»“åº“ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥ä¸å†ä¾èµ–äºè¿œç¨‹æ‹‰å–é•œåƒï¼Œåœ¨æ­å»ºK3sé›†ç¾¤æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ•°æ®å­˜å‚¨èŠ‚ç‚¹ï¼Œæ—¢å­˜å‚¨å„ä¸ªAgentä¸Serverçš„æ•°æ®ï¼Œä¹Ÿå­˜å‚¨æˆ‘ä»¬éœ€è¦çš„ä¸“å±é•œåƒæ•°æ®ã€‚\nç”±äºregistryè¿™ä¸ªé•œåƒæš‚æ—¶ä¹Ÿä¸é€‚é…RiscVæ¶æ„ï¼ˆä¼šå‡ºç°ç»å…¸çš„manifesté—®é¢˜ï¼‰\næ‰€ä»¥æˆ‘ä»¬å…ˆåœ¨arm(macos)ä¸Šå°è¯•ä¸€ä¸‹ç§æœ‰é•œåƒå¦‚ä½•æ­å»ºã€‚\nç§æœ‰é•œåƒæ­å»ºå®éªŒ æœ¬æ¬¡å®éªŒå°†Macä¸»æœºç§æœ‰é•œåƒåº“çš„ç‰©ç†æœºï¼Œä¸€å°RiscVå¼€å‘æ¿ä½œä¸ºæ‹‰å–é•œåƒçš„æœºå™¨ã€‚\né¦–å…ˆï¼Œåœ¨Macä¸Šæ„å»ºRegistryå®¹å™¨ã€‚\n# è¿™é‡Œæˆ‘é€‰æ‹©6000ç«¯å£ä½œä¸ºæœ¬æœºç«¯å£ï¼ˆ5000è¢«ç³»ç»Ÿå ç”¨ï¼Œæ— æ³•å½»åº•æ€æ­»ï¼‰ docker run -d -p 6000:5000 --restart=always --name registry registry:2 æ„å»ºæˆåŠŸåï¼Œå¦‚æœä½ ä½¿ç”¨DockerDesktopå¯ä»¥åœ¨å…¶ä¸­å®¹å™¨éƒ¨åˆ†å‘ç°å®¹å™¨å·²ç»åœ¨æ­£å¸¸è¿è¡Œäº†ã€‚æˆ‘ä»¬å†è¿›è¡Œä¸€ä¸‹ç›¸å…³æµ‹è¯•curl http://:6000/v2/,å…¶ä¼šè¿”å›\"repository[]\"ä¿¡æ¯ï¼Œè¯æ˜æˆåŠŸã€‚\nè¿™æ—¶æˆ‘ä»¬éšä¾¿æ‹‰ä¸‹æ¥ä¸€ä¸ªé•œåƒè¿›è¡Œæµ‹è¯•docker pull busybox:latest å¯¹è¿™ä¸ªé•œåƒè¿›è¡Œæ‰“æ ‡ç­¾ï¼Œå¹¶æ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­ã€‚(æ‰“æ ‡ç­¾æ“ä½œæœ¬è´¨ä¸Šæ˜¯å¤åˆ¶ä¸€ä»½é•œåƒå¹¶ä¸ºå…¶æ”¹å)\n# æ³¨æ„ï¼Œå°†åç»­çš„macIPæ”¹ä¸ºè‡ªå·±æœ¬æœºçš„IPåœ°å€ # åŸæœ¬tagå‘½ä»¤ä¸éœ€è¦IPï¼Œä½†æ˜¯å¦‚æœæŒ‡å‘ç§æœ‰åœ°å€ï¼Œåˆ™éœ€è¦å¸¦ä¸Šç§æœ‰åœ°å€IP docker tag busybox:latest :6000/riscv64/busybox:1 # å°†æ­¤é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­ docker push :6000/riscv64/busybox:1 ç»“æœå¦‚ä¸‹\nThe push refers to repository [192.168.173.76:6000/riscv64/busybox] be632cf9bbb6: Pushed 1: digest: sha256:c109a60479ed80d63b17808a6f993228b6ace6255064160ea82adfa01c36deba size: 527 åŒç†å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„curlå‘½ä»¤æµ‹è¯•å½“å‰ç§æœ‰ä»“åº“ä¸­çš„é•œåƒåˆ—è¡¨ã€‚\n**å…¶æ¬¡ï¼Œæœ¬æ¬¡å®éªŒä¸ºäº†æ–¹ä¾¿æš‚æ—¶ä½¿ç”¨HTTPï¼Œæ²¡æœ‰ä½¿ç”¨HTTPS,å³å¸¦æœ‰TLSçš„æ–¹å¼ã€‚**å¹¶ä¸”æœ¬æ¬¡å®éªŒçš„ä¸»æœºä¸å¼€å‘æ¿è¿åœ¨åŒä¸€ä¸ªå­ç½‘ï¼ˆçƒ­ç‚¹ï¼‰ä¸‹ï¼Œåç»­æˆ‘ä»¬ä¼šæ¢ç©¶ä½¿ç”¨httpsçš„æ–¹å¼ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬æœºä¸å¼€å‘æ¿ä¸Šçš„dockerçš„é…ç½®æ–‡ä»¶ä¸­åŒæ—¶æ·»åŠ \n{ \"insecure-registries\": [\":6000\"] } ç„¶åï¼Œé‡å¯Dockersudo systemctl restart docker\næœ€åï¼Œæ¥åˆ°RiscVå¼€å‘æ¿ä¸Šæ‹‰å–é•œåƒdocker pull :6000/riscv64/busybox:1ï¼Œä½¿ç”¨docker imagesè¿›è¡Œæ£€æŸ¥å‘ç°å…¶å­˜åœ¨ã€‚\nè¿™æ ·æˆ‘ä»¬å°±åšåˆ°äº†ä»ç§æœ‰ä»“åº“æ‹‰å–äº†ä¸€ä¸ªæˆ‘ä»¬åœ¨å¼€å‘æ¿ä¸Šæ‹‰å–ä¸åˆ°çš„é•œåƒåˆ°å¼€å‘æ¿ä¸Šï¼Œè¿™å¯¹äºæˆ‘ä»¬æ—¥åçš„é›†ç¾¤æ­å»ºå·¥ä½œèµ·åˆ°äº†å…³é”®çš„ä½œç”¨ã€‚\nèå…¥k3s ç”±äºk3sçš„å®¹å™¨è¿è¡Œæ—¶é‡‡ç”¨containerdè¿™ä¸ªè½»é‡åŒ–çš„åŸç”Ÿå·¥å…·è€Œä¸å»ºè®®ä½¿ç”¨dockerï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹k3sçš„registries.yamlæ–‡ä»¶è¿›è¡Œä¿®æ”¹,å°†é•œåƒåœ°å€å…¨éƒ¨ä¿®æ”¹ä¸ºæˆ‘ä»¬ä¸Šé¢æ­å»ºçš„ç§æœ‰ä»“åº“åœ°å€ã€‚\nmirrors: docker.io: endpoint: - \"http://192.168.173.76:6000\" # è¿™é‡Œåç»­æˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•å°†é™æ€çš„IPåœ°å€å†™æˆåŠ¨æ€æˆ–è€…å¦‚ä½•é¢å¯¹IPå˜åŒ–çš„æƒ…å†µ - \"docker.1ms.run\" # ä¿é™©èµ·è§è®¾ç½®ä¸€ä¸ªå…¶ä»–çš„é•œåƒä»“åº“ rewrite: \"^riscv64/(.*)\": \"riscv64/$1\" \"192.168.173.76:6000\": endpoint: - \"http://192.168.173.76:6000\" ä¹‹åå†ä½¿ç”¨crictlå‘½ä»¤è¿›è¡Œæ‹‰å–æ—¶å°±å¯ä»¥ç›´æ¥crictl pull \u003cé•œåƒåç§°\u003e,æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬çš„é•œåƒå‰é¢éƒ½æ˜¯æ ‡æœ‰ä»“åº“åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨crictl pullæ—¶ç›´æ¥ä½¿ç”¨é•œåƒåç§°å³å¯ã€‚\nå¸¸ç”¨æ“ä½œ æ£€æŸ¥ç§æœ‰ä»“åº“ä¸­æœ‰å“ªäº›é•œåƒã€‚\ncurl -X GET http://192.168.173.76:6000/v2/_catalog # ç»“æœå¦‚ä¸‹ {\"repositories\":[\"busybox\",\"mac_riscv64/alpine\",\"riscv64/busybox\"]} å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ é¦–å…ˆæˆ‘ä»¬å…ˆæŠ›å¼€k3s,ä½¿ç”¨dockeræ¥è¿›è¡Œç§»æ¤é€‚é…æ“ä½œï¼Œæ¯•ç«ŸäºŒè€…æ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œè€Œdockerå¯ä»¥æä¾›æ›´å¼ºå¤§çš„æ€§èƒ½ã€‚æ“ä½œæµç¨‹æ¥è‡ªäºDockerå®˜æ–¹æ–‡æ¡£ä¸­çš„ä½¿ç”¨QEMUè¿›è¡Œå¤šå¹³å°é•œåƒæ„å»ºæ–¹æ³•ï¼Œè¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼Œå¸Œæœ›åé¢æˆ‘ä»¬å¯ä»¥å°è¯•å¦å¤–ä¸¤ç§æ–¹æ³•ã€‚\nè¿™æ¬¡æˆ‘ä»¬è¦é€‚é…çš„é•œåƒæ˜¯rediså’Œnginxï¼Œæ“ä½œçš„ä¸»æœºæ˜¯Macbook M2,ä½¿ç”¨Docker Desktopæ–¹ä¾¿æ“ä½œã€‚\næå‰é…ç½® æ ¹æ®æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä»classicé•œåƒæ¨¡å¼è½¬æ¢ä¸ºcontainerdé•œåƒæ¨¡å¼ï¼Œè¿™åœ¨Docker Desktopä¸Šå¾ˆå¥½æ“ä½œã€‚\næ“ä½œæµç¨‹ 1.æ–°å»ºç›®å½•ä¿å­˜redisç­‰ä¸­é—´ä»¶çš„æºç ï¼Œä¸ºå…¶ç¼–å†™çš„Dockerfileï¼Œä»¥åŠå¯èƒ½è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ç­‰æ–‡ä»¶ã€‚\nmkdir -p multi-platform 2.ä¸ºäº†é˜²æ­¢å®¹å™¨å†…éƒ¨ä¸‹è½½é€Ÿåº¦è¿‡æ…¢ï¼Œæå‰ä¸‹è½½å¥½redisçš„æºç æ–‡ä»¶å¹¶è§£å‹åˆ°æœ¬æœºã€‚\nwget https://download.redis.io/releases/redis-7.2.4.tar.gz tar -xzvf redis-7.2.4.tar.gz 3.ç¼–å†™Dockerfileæ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„æˆ‘ä»¬ä½¿ç”¨alpine:latestä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™ä¸ªé•œåƒæ˜¯æˆ‘å°è¯•çš„å‡ ä¸ªåŸºç¡€é•œåƒä¸­é€‚é…riscvæœ€å¥½çš„ï¼›åŒæ—¶éœ€è¦æ›¿æ¢é»˜è®¤çš„apkåŒ…é•œåƒæºï¼Œå¦åˆ™ä¼šé‡åˆ°could not connect serveré—®é¢˜ï¼›ä¸ºäº†è®¾ç½®å¯†ç ç­‰ä¸€äº›è‡ªå®šä¹‰é…ç½®ï¼Œæˆ‘ä»¬è‡ªè¡Œç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸­redis.conf\n# å…è®¸æ‰€æœ‰ IP è¿æ¥ï¼ˆä¸è¦ç»‘å®š 127.0.0.1ï¼‰ bind 0.0.0.0 # å…³é—­ protected modeï¼Œå¦åˆ™å¤–éƒ¨æ— æ³•è¿æ¥ protected-mode no # è®¾ç½®è®¿é—®å¯†ç  requirepass password # è®¾ç½®æŒä¹…åŒ– RDB ä¿å­˜ç­–ç•¥ save 900 1 save 300 10 save 60 10000 # RDB æ–‡ä»¶å dbfilename dump.rdb # RDB æ–‡ä»¶ä¿å­˜è·¯å¾„ dir ./ # æ—¥å¿—çº§åˆ« loglevel notice # æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆå®¹å™¨ä¸­å»ºè®®è¿™æ ·ï¼‰ logfile \"\" # åå°è¿è¡Œï¼Œå®¹å™¨ä¸­ä¸èƒ½å¼€å¯ daemonize no # æœ€å¤§è¿æ¥æ•°ï¼ˆå¯é€‰ï¼‰ maxclients 10000 # è®¾ç½®å†…å­˜ä¸Šé™ï¼ˆå¯é€‰ï¼‰ # maxmemory 256mb # maxmemory-policy allkeys-lru è¿™æ˜¯Dockerfile:\nFROM alpine:latest # æ›¿æ¢é»˜è®¤ apk æºä¸ºé•œåƒæº RUN sed -i 's#https\\?://dl-cdn.alpinelinux.org/alpine#http://mirrors.aliyun.com/alpine#g' /etc/apk/repositories # å®‰è£… Redis æ„å»ºä¾èµ– RUN apk update \u0026\u0026 apk add --no-cache build-base jemalloc-dev linux-headers # æ‹·è´ Redis æºç ï¼ˆå‡è®¾ redis-7.2.4 æ–‡ä»¶å¤¹å’Œ Dockerfile åŒç›®å½•ï¼‰ COPY redis-7.2.4 /redis WORKDIR /redis # ç¼–è¯‘ Redis RUN make # æ‹·è´é…ç½®æ–‡ä»¶ COPY redis.conf /etc/redis.conf # è®¾ç½®é»˜è®¤å¯åŠ¨å‘½ä»¤ CMD [\"src/redis-server\", \"/etc/redis.conf\"] 4.æ„å»ºè·¨å¹³å°é•œåƒã€‚è¿™ä¸€æ­¥æœ¬è´¨ä¸Šç”¨åˆ°äº†buildxå’ŒQEMUï¼Œä½†æ˜¯Docker Desktopä¸ºæˆ‘ä»¬æŠŠè¿™äº›åº•å±‚éƒ½å°è£…äº†èµ·æ¥ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯ç”¨Docker Desktopå¯åŠ¨çš„Dockerå°±ä¸ç”¨åœ¨æ„;æ„å»ºçš„åŒæ—¶å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œè¯·åœ¨å‚æ•°ä¸­æ·»åŠ --network hostå‘½ä»¤ï¼Œè¿™ä¼šå°†å®¿ä¸»æœºç½‘ç»œä½œä¸ºå®¹å™¨å†…éƒ¨ç½‘ç»œï¼Œç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚è¿™ä¸ªè§£å†³æ€è·¯æ¥è‡ªäºstackoverflow\n# è¿™é‡Œæˆ‘ä»¬ç›´æ¥-tæ‰“å¥½äº†æ ‡ç­¾ï¼Œä¸ç”¨å†tagäº† docker build --network host --platform=linux/riscv64 -f Dockerfile.redis -t 192.168.173.76:6000/riscv64/redis:1.1 . 5.æ¨é€åˆ°æœ¬åœ°ç§æœ‰é•œåƒä»“åº“ä¸­ï¼Œå†ä»RiscVå¼€å‘æ¿ä¸­æ‹‰å–è¯¥é•œåƒ,è¿™ä¸€æ­¥å’Œä¸Šé¢ç§æœ‰é•œåƒä»“åº“æ„å»ºç›¸åŒã€‚\ndocker push 192.168.173.76:6000/riscv64/redis:1.1 # riscvä¸‹ docker pull 192.168.173.76:6000/riscv64/redis:1.1 6.è¿è¡Œredis-serverå®¹å™¨ï¼Œå¹¶åœ¨ä¸»æœºä¸Šè¿è¡Œredis-cliæ¥æµ‹è¯•\ndocker run -d --name redis-test -p 6379:6379 192.168.173.76:6000/riscv64/redis:1.1 # ä¸»æœºè¿è¡Œ redis-cli -h -p 6379 \u003e AUTH password \u003e set foo bar \u003e get foo å¾—åˆ°æœ€ç»ˆç»“æœ\"bar\",è¯æ˜æˆ‘ä»¬æˆåŠŸäº†ï¼\nåŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸‹nginxé•œåƒï¼Œä¸‹é¢æ˜¯å…¶ç®€å•çš„dockerfile\nFROM alpine:latest # æ›¿æ¢æºï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¸…åæºï¼‰ RUN sed -i 's#dl-cdn.alpinelinux.org#mirrors.aliyun.com#g' /etc/apk/repositories \\ \u0026\u0026 apk update \u0026\u0026 apk add --no-cache nginx # æ‹·è´é…ç½®æ–‡ä»¶å’Œé™æ€èµ„æº COPY nginx.conf /etc/nginx/nginx.conf COPY html/ /usr/share/nginx/html/ # æš´éœ²ç«¯å£ EXPOSE 80 # å¯åŠ¨ Nginx CMD [\"nginx\", \"-g\", \"daemon off;\"] å…¶ä¸­çš„nginx.conf\nworker_processes 1; events { worker_connections 1024; } http { include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server { listen 80; server_name localhost; location / { root /usr/share/nginx/html; index index.html index.htm; } } } å¯¹åº”çš„htmlæ–‡ä»¶å†…å®¹:\n\u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003ctitle\u003eWelcome to RISC-V Nginx!\u003c/title\u003e \u003cstyle\u003e body { font-family: \"Segoe UI\", sans-serif; background-color: #f4f4f4; text-align: center; padding-top: 100px; } h1 { color: #333; } p { color: #777; } .tag { display: inline-block; margin-top: 20px; padding: 8px 16px; background-color: #007acc; color: white; border-radius: 4px; font-weight: bold; } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003eğŸš€ Hello from RISC-V Nginx!\u003c/h1\u003e \u003cp\u003eYour nginx server is up and running.\u003c/p\u003e \u003cdiv class=\"tag\"\u003eriscv64 / alpine / nginx\u003c/div\u003e \u003c/body\u003e \u003c/html\u003e åŒç†æ‰“åŒ…æ¨é€æ‹‰å–ã€‚è¿è¡Œå®¹å™¨åï¼Œåœ¨æˆ‘çš„macä¸»æœºä¸Šè®¿é—®http://:8080å¯ä»¥çœ‹åˆ°ä¸Šè¿°htmlæ–‡ä»¶çš„æ•ˆæœ\nä¼˜åŒ–é•œåƒ å½“å‰redisé•œåƒå¤§å°ä¸º146MB\n(base) lutao@MagicTech multi-platform % docker images | grep redis 192.168.173.76:6000/riscv64/redis 1.1 e8e1336c3ccf 13 hours ago 146MB æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤šé˜¶æ®µæ„å»ºä»¥ç²¾ç®€æœ€ç»ˆé•œåƒï¼Œä½¿å…¶ä¸åŒ…å«æ„å»ºå·¥å…·å’Œæºä»£ç ã€‚\n# ---------- æ„å»ºé˜¶æ®µ ---------- FROM alpine:latest AS builder # ä½¿ç”¨é˜¿é‡ŒæºåŠ é€Ÿ RUN sed -i 's#http.*/alpine#http://mirrors.aliyun.com/alpine#g' /etc/apk/repositories # å®‰è£…æ„å»ºä¾èµ– RUN apk update \u0026\u0026 apk add --no-cache build-base jemalloc-dev linux-headers # æ‹·è´æºç  COPY redis-7.2.4 /redis WORKDIR /redis # ç¼–è¯‘ Redis RUN make # ---------- è¿è¡Œé˜¶æ®µ ---------- FROM alpine:latest # ä½¿ç”¨é˜¿é‡Œæºï¼ˆå¯é€‰ï¼‰ RUN sed -i 's#http.*/alpine#http://mirrors.aliyun.com/alpine#g' /etc/apk/repositories # å®‰è£…è¿è¡Œæ‰€éœ€çš„ jemalloc RUN apk add --no-cache jemalloc # æ‹·è´ redis-server å’Œ redis-cliï¼ˆå¦‚æœä½ éœ€è¦ CLI å·¥å…·ï¼‰ COPY --from=builder /redis/src/redis-server /usr/local/bin/ COPY --from=builder /redis/src/redis-cli /usr/local/bin/ # æ‹·è´é…ç½®æ–‡ä»¶ COPY redis.conf /etc/redis.conf # è®¾ç½®é»˜è®¤å¯åŠ¨å‘½ä»¤ CMD [\"redis-server\", \"/etc/redis.conf\"] æœ€ç»ˆæ„å»ºè¿‡ç¨‹èŠ±è´¹293.4s\næœ€ç»ˆé•œåƒå¤§å°åªæœ‰10.2MBï¼Œç›¸è¾ƒäºä¹‹å‰çš„146MBç¼©å°äº†è®¸å¤šã€‚\nåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ªåªæœ‰redis-cliçš„é•œåƒï¼Œå¯¹äºèåˆè¿›k3sé›†ç¾¤ä¸­æˆ–è®¸å¯ä»¥åœ¨serverèŠ‚ç‚¹ä¸Šä½¿ç”¨redis-serveré•œåƒï¼Œç„¶ååœ¨å…¶ä»–agentèŠ‚ç‚¹çš„podä¸­éƒ¨ç½²redis-cliå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚\næ€»ç»“ æ­å»ºäº†ä¸€ä¸ªç®€æ˜“çš„ç§æœ‰é•œåƒä»“åº“å’Œç§»æ¤äº†redis-serveré•œåƒåˆ°RiscVæœºå™¨ä¸Šï¼Œç®—æ˜¯è¿ˆå‡ºäº†ä¸é”™çš„ä¸€æ­¥ï¼Œåé¢çš„å·¥ä½œä¸»è¦å›´ç»•ç€å¦‚ä½•å°†å…¶æ›´æ·±å…¥åœ°èå…¥åˆ°k3sä¸­ä»¥åŠæ·±å…¥æ¢ç©¶dockerçš„å¤šå¹³å°æ„å»ºå…¶åº•å±‚åŸç†å±•å¼€ã€‚\nè¿™é‡Œæ˜¯LTXï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡åšå®¢ï¼Œäººç”Ÿæµ·æµ·ï¼Œå’Œè‡ªå·±å¯¹è¯ï¼Œåƒåªè´è¶çºµæ¨ªå››æµ·ã€‚\n",
  "wordCount" : "3600",
  "inLanguage": "zh",
  "image": "https://LTXWorld.github.io/images/papermod-cover.png","datePublished": "2025-04-02T19:10:13+08:00",
  "dateModified": "2025-04-02T19:10:13+08:00",
  "author":{
    "@type": "Person",
    "name": "LTX"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://LTXWorld.github.io/posts/016k3sep03%E7%A7%BB%E6%A4%8D%E9%95%9C%E5%83%8F%E5%88%B0riscv%E5%BC%80%E5%8F%91%E6%9D%BF/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "LTX's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://LTXWorld.github.io/favicon.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://LTXWorld.github.io/" accesskey="h" title="LTX&#39;s Blog (Alt + H)">LTX&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://LTXWorld.github.io/" title="LTX&#39;s Blog">
                    <span>é¦–é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://LTXWorld.github.io/archives/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://LTXWorld.github.io/categories/" title="Categories">
                    <span>åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://LTXWorld.github.io/tags/" title="Tags">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://LTXWorld.github.io/search/" title="æœç´¢">
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://LTXWorld.github.io/about/" title="åèŠ±å›­">
                    <span>å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      K3sEP03â€”â€”ç§»æ¤é•œåƒåˆ°RiscVå¼€å‘æ¿
    </h1>
    <div class="post-meta"><span title='2025-04-02 19:10:13 +0800 CST'>å››æœˆ 2, 2025</span>&nbsp;Â·&nbsp;8 åˆ†é’Ÿ&nbsp;Â·&nbsp;LTX

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e5%bc%95%e5%ad%90" aria-label="å¼•å­">å¼•å­</a></li>
                <li>
                    <a href="#%e7%a7%81%e6%9c%89%e9%95%9c%e5%83%8f%e4%bb%93%e5%ba%93" aria-label="ç§æœ‰é•œåƒä»“åº“">ç§æœ‰é•œåƒä»“åº“</a><ul>
                        
                <li>
                    <a href="#%e7%a7%81%e6%9c%89%e9%95%9c%e5%83%8f%e6%90%ad%e5%bb%ba%e5%ae%9e%e9%aa%8c" aria-label="ç§æœ‰é•œåƒæ­å»ºå®éªŒ">ç§æœ‰é•œåƒæ­å»ºå®éªŒ</a></li>
                <li>
                    <a href="#%e8%9e%8d%e5%85%a5k3s" aria-label="èå…¥k3s">èå…¥k3s</a></li>
                <li>
                    <a href="#%e5%b8%b8%e7%94%a8%e6%93%8d%e4%bd%9c" aria-label="å¸¸ç”¨æ“ä½œ">å¸¸ç”¨æ“ä½œ</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%9a%e5%b9%b3%e5%8f%b0%e6%9e%84%e5%bb%ba%e9%80%82%e9%85%8d%e7%9a%84%e9%95%9c%e5%83%8f" aria-label="å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ">å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ</a><ul>
                        
                <li>
                    <a href="#%e6%8f%90%e5%89%8d%e9%85%8d%e7%bd%ae" aria-label="æå‰é…ç½®">æå‰é…ç½®</a></li>
                <li>
                    <a href="#%e6%93%8d%e4%bd%9c%e6%b5%81%e7%a8%8b" aria-label="æ“ä½œæµç¨‹">æ“ä½œæµç¨‹</a></li>
                <li>
                    <a href="#%e4%bc%98%e5%8c%96%e9%95%9c%e5%83%8f" aria-label="ä¼˜åŒ–é•œåƒ">ä¼˜åŒ–é•œåƒ</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%80%bb%e7%bb%93" aria-label="æ€»ç»“">æ€»ç»“</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="å¼•å­">å¼•å­<a hidden class="anchor" aria-hidden="true" href="#å¼•å­">#</a></h2>
<p>äº†è§£K3sçš„éƒ½çŸ¥é“ï¼ŒPodï¼Œå®¹å™¨ï¼Œé•œåƒåœ¨K3sä¸­çš„é‡è¦ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦å…‹æœçš„éš¾ç‚¹æ­£æ˜¯å¦‚ä½•è®©é•œåƒä»¬é€‚é…RiscVæ¶æ„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æ‹‰å–é•œåƒéƒ½æ¥è‡ªäºdockerhub,é‡Œé¢æœç´¢ç¡®å®æœ‰ä¸€äº›RiscVé•œåƒï¼Œä¾‹å¦‚<code>riscv64/nginx,riscv64/redis</code>ç­‰ï¼Œä½†æ˜¯ç»æ£€æŸ¥ï¼Œå…¶å®å®ƒå¹¶ä¸æ˜¯å®˜æ–¹è®¤è¯çš„é•œåƒï¼Œä¹Ÿå‡ ä¹æ²¡æœ‰è¢«ç»´æŠ¤æˆ–è€…ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å»è¿›è¡Œé•œåƒçš„é€‚é…ã€‚
æ‹¿nginxé•œåƒä¸¾ä¾‹:</p>
<p><code>docker search riscv64/nginx</code></p>
<p>æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„é•œåƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">riscv64/nginx                            Official build of Nginx.                         <span class="m">0</span>
</span></span><span class="line"><span class="cl">nginx/nginx-ingress                      NGINX and  NGINX Plus Ingress Controllers foâ€¦   <span class="m">102</span>
</span></span><span class="line"><span class="cl">nginx/nginx-prometheus-exporter          NGINX Prometheus Exporter <span class="k">for</span> NGINX and NGINâ€¦   <span class="m">49</span>
</span></span><span class="line"><span class="cl">nginx/nginx-ingress-operator             NGINX Ingress Operator <span class="k">for</span> NGINX and NGINX Pâ€¦   <span class="m">2</span>
</span></span><span class="line"><span class="cl">nginx/unit                               This repository is retired, use the Docker oâ€¦   <span class="m">65</span>
</span></span><span class="line"><span class="cl">nginx/nginx-quic-qns                     NGINX QUIC interop                               <span class="m">1</span>
</span></span><span class="line"><span class="cl">nginxproxy/nginx-proxy                   Automated nginx proxy <span class="k">for</span> Docker containers â€¦   <span class="m">161</span>
</span></span><span class="line"><span class="cl">nginx                                    Official build of Nginx.                         <span class="m">20719</span>     <span class="o">[</span>OK<span class="o">]</span>
</span></span></code></pre></div><p>å¯ä»¥å‘ç°<code>riscv64/nginx</code>çš„Starsæ•°é‡ä¸º0ï¼Œä¹Ÿä¸æ˜¯å®˜æ–¹é•œåƒï¼Œæ‰€ä»¥æ‹‰å–å¤±è´¥ã€‚ï¼ˆå³ä½¿ä½¿ç”¨ä»£ç†åœ°å€ï¼Œå¼€å‘æ¿ä¸Šä¹Ÿä¼šé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œå› ä¸ºä»£ç†åœ°å€ä¸­ä¹Ÿæ²¡ä¿å­˜éå®˜æ–¹çš„é•œåƒï¼‰</p>
<p>ç”±æ­¤å¯è§ï¼Œè‡ªè¡Œæ„å»ºåˆé€‚çš„é•œåƒè¿«åœ¨çœ‰ç«ã€‚</p>
<h2 id="ç§æœ‰é•œåƒä»“åº“">ç§æœ‰é•œåƒä»“åº“<a hidden class="anchor" aria-hidden="true" href="#ç§æœ‰é•œåƒä»“åº“">#</a></h2>
<p>Dockerä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§æ„å»ºç§æœ‰é•œåƒä»“åº“çš„èƒ½åŠ›ï¼Œåˆ©ç”¨å…¶registryé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥æ­å»ºä¸€ä¸ªç§äººçš„é•œåƒä»“åº“ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥ä¸å†ä¾èµ–äºè¿œç¨‹æ‹‰å–é•œåƒï¼Œåœ¨æ­å»ºK3sé›†ç¾¤æ—¶ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºæ•°æ®å­˜å‚¨èŠ‚ç‚¹ï¼Œæ—¢å­˜å‚¨å„ä¸ªAgentä¸Serverçš„æ•°æ®ï¼Œä¹Ÿå­˜å‚¨æˆ‘ä»¬éœ€è¦çš„ä¸“å±é•œåƒæ•°æ®ã€‚</p>
<p>ç”±äºregistryè¿™ä¸ªé•œåƒæš‚æ—¶ä¹Ÿä¸é€‚é…RiscVæ¶æ„ï¼ˆä¼šå‡ºç°ç»å…¸çš„manifesté—®é¢˜ï¼‰</p>
<p>æ‰€ä»¥æˆ‘ä»¬å…ˆåœ¨arm(macos)ä¸Šå°è¯•ä¸€ä¸‹ç§æœ‰é•œåƒå¦‚ä½•æ­å»ºã€‚</p>
<h3 id="ç§æœ‰é•œåƒæ­å»ºå®éªŒ">ç§æœ‰é•œåƒæ­å»ºå®éªŒ<a hidden class="anchor" aria-hidden="true" href="#ç§æœ‰é•œåƒæ­å»ºå®éªŒ">#</a></h3>
<p>æœ¬æ¬¡å®éªŒå°†Macä¸»æœºç§æœ‰é•œåƒåº“çš„ç‰©ç†æœºï¼Œä¸€å°RiscVå¼€å‘æ¿ä½œä¸ºæ‹‰å–é•œåƒçš„æœºå™¨ã€‚</p>
<p><strong>é¦–å…ˆï¼Œåœ¨Macä¸Šæ„å»ºRegistryå®¹å™¨ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œæˆ‘é€‰æ‹©6000ç«¯å£ä½œä¸ºæœ¬æœºç«¯å£ï¼ˆ5000è¢«ç³»ç»Ÿå ç”¨ï¼Œæ— æ³•å½»åº•æ€æ­»ï¼‰</span>
</span></span><span class="line"><span class="cl">docker run -d -p 6000:5000 --restart<span class="o">=</span>always --name registry registry:2
</span></span></code></pre></div><p>æ„å»ºæˆåŠŸåï¼Œå¦‚æœä½ ä½¿ç”¨DockerDesktopå¯ä»¥åœ¨å…¶ä¸­å®¹å™¨éƒ¨åˆ†å‘ç°å®¹å™¨å·²ç»åœ¨æ­£å¸¸è¿è¡Œäº†ã€‚æˆ‘ä»¬å†è¿›è¡Œä¸€ä¸‹ç›¸å…³æµ‹è¯•<code>curl http://&lt;macIP&gt;:6000/v2/</code>,å…¶ä¼šè¿”å›<code>&quot;repository[]&quot;</code>ä¿¡æ¯ï¼Œè¯æ˜æˆåŠŸã€‚</p>
<p>è¿™æ—¶æˆ‘ä»¬éšä¾¿æ‹‰ä¸‹æ¥ä¸€ä¸ªé•œåƒè¿›è¡Œæµ‹è¯•<code>docker pull busybox:latest</code>
å¯¹è¿™ä¸ªé•œåƒè¿›è¡Œæ‰“æ ‡ç­¾ï¼Œå¹¶æ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­ã€‚(æ‰“æ ‡ç­¾æ“ä½œæœ¬è´¨ä¸Šæ˜¯å¤åˆ¶ä¸€ä»½é•œåƒå¹¶ä¸ºå…¶æ”¹å)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æ³¨æ„ï¼Œå°†åç»­çš„macIPæ”¹ä¸ºè‡ªå·±æœ¬æœºçš„IPåœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åŸæœ¬tagå‘½ä»¤ä¸éœ€è¦IPï¼Œä½†æ˜¯å¦‚æœæŒ‡å‘ç§æœ‰åœ°å€ï¼Œåˆ™éœ€è¦å¸¦ä¸Šç§æœ‰åœ°å€IP</span>
</span></span><span class="line"><span class="cl">docker tag busybox:latest &lt;macIP&gt;:6000/riscv64/busybox:1
</span></span><span class="line"><span class="cl"><span class="c1"># å°†æ­¤é•œåƒæ¨é€åˆ°ç§æœ‰ä»“åº“ä¸­</span>
</span></span><span class="line"><span class="cl">docker push &lt;macIP&gt;:6000/riscv64/busybox:1
</span></span></code></pre></div><p>ç»“æœå¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">The push refers to repository <span class="o">[</span>192.168.173.76:6000/riscv64/busybox<span class="o">]</span>
</span></span><span class="line"><span class="cl">be632cf9bbb6: Pushed
</span></span><span class="line"><span class="cl">1: digest: sha256:c109a60479ed80d63b17808a6f993228b6ace6255064160ea82adfa01c36deba size: <span class="m">527</span>
</span></span></code></pre></div><p>åŒç†å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„curlå‘½ä»¤æµ‹è¯•å½“å‰ç§æœ‰ä»“åº“ä¸­çš„é•œåƒåˆ—è¡¨ã€‚</p>
<p>**å…¶æ¬¡ï¼Œæœ¬æ¬¡å®éªŒä¸ºäº†æ–¹ä¾¿æš‚æ—¶ä½¿ç”¨HTTPï¼Œæ²¡æœ‰ä½¿ç”¨HTTPS,å³å¸¦æœ‰TLSçš„æ–¹å¼ã€‚**å¹¶ä¸”æœ¬æ¬¡å®éªŒçš„ä¸»æœºä¸å¼€å‘æ¿è¿åœ¨åŒä¸€ä¸ªå­ç½‘ï¼ˆçƒ­ç‚¹ï¼‰ä¸‹ï¼Œåç»­æˆ‘ä»¬ä¼šæ¢ç©¶ä½¿ç”¨httpsçš„æ–¹å¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬æœºä¸å¼€å‘æ¿ä¸Šçš„dockerçš„é…ç½®æ–‡ä»¶ä¸­åŒæ—¶æ·»åŠ </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;insecure-registries&#34;</span>: <span class="o">[</span><span class="s2">&#34;&lt;macIP&gt;:6000&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åï¼Œé‡å¯Docker<code>sudo systemctl restart docker</code></p>
<p>æœ€åï¼Œæ¥åˆ°RiscVå¼€å‘æ¿ä¸Šæ‹‰å–é•œåƒ<code>docker pull &lt;macIP&gt;:6000/riscv64/busybox:1</code>ï¼Œä½¿ç”¨<code>docker images</code>è¿›è¡Œæ£€æŸ¥å‘ç°å…¶å­˜åœ¨ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±åšåˆ°äº†ä»ç§æœ‰ä»“åº“æ‹‰å–äº†ä¸€ä¸ªæˆ‘ä»¬åœ¨å¼€å‘æ¿ä¸Šæ‹‰å–ä¸åˆ°çš„é•œåƒåˆ°å¼€å‘æ¿ä¸Šï¼Œè¿™å¯¹äºæˆ‘ä»¬æ—¥åçš„é›†ç¾¤æ­å»ºå·¥ä½œèµ·åˆ°äº†å…³é”®çš„ä½œç”¨ã€‚</p>
<p><img loading="lazy" src="/img/jb/coffee.webp"></p>
<h3 id="èå…¥k3s">èå…¥k3s<a hidden class="anchor" aria-hidden="true" href="#èå…¥k3s">#</a></h3>
<p>ç”±äºk3sçš„å®¹å™¨è¿è¡Œæ—¶é‡‡ç”¨containerdè¿™ä¸ªè½»é‡åŒ–çš„åŸç”Ÿå·¥å…·è€Œä¸å»ºè®®ä½¿ç”¨dockerï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é’ˆå¯¹k3sçš„<code>registries.yaml</code>æ–‡ä»¶è¿›è¡Œä¿®æ”¹,å°†é•œåƒåœ°å€å…¨éƒ¨ä¿®æ”¹ä¸ºæˆ‘ä»¬ä¸Šé¢æ­å»ºçš„ç§æœ‰ä»“åº“åœ°å€ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">mirrors</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">docker.io</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;http://192.168.173.76:6000&#34;</span><span class="w"> </span><span class="c"># è¿™é‡Œåç»­æˆ‘ä»¬è¦æ€è€ƒå¦‚ä½•å°†é™æ€çš„IPåœ°å€å†™æˆåŠ¨æ€æˆ–è€…å¦‚ä½•é¢å¯¹IPå˜åŒ–çš„æƒ…å†µ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;docker.1ms.run&#34;</span><span class="w"> </span><span class="c"># ä¿é™©èµ·è§è®¾ç½®ä¸€ä¸ªå…¶ä»–çš„é•œåƒä»“åº“</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rewrite</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">&#34;^riscv64/(.*)&#34;: </span><span class="s2">&#34;riscv64/$1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s2">&#34;192.168.173.76:6000&#34;</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;http://192.168.173.76:6000&#34;</span><span class="w">
</span></span></span></code></pre></div><p>ä¹‹åå†ä½¿ç”¨crictlå‘½ä»¤è¿›è¡Œæ‹‰å–æ—¶å°±å¯ä»¥ç›´æ¥<code>crictl pull &lt;é•œåƒåç§°&gt;</code>,æ³¨æ„ï¼Œç”±äºæˆ‘ä»¬çš„é•œåƒå‰é¢éƒ½æ˜¯æ ‡æœ‰ä»“åº“åœ°å€çš„ï¼Œæ‰€ä»¥åœ¨<code>crictl pull</code>æ—¶ç›´æ¥ä½¿ç”¨é•œåƒåç§°å³å¯ã€‚</p>
<h3 id="å¸¸ç”¨æ“ä½œ">å¸¸ç”¨æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#å¸¸ç”¨æ“ä½œ">#</a></h3>
<p>æ£€æŸ¥ç§æœ‰ä»“åº“ä¸­æœ‰å“ªäº›é•œåƒã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X GET http://192.168.173.76:6000/v2/_catalog
</span></span><span class="line"><span class="cl"><span class="c1"># ç»“æœå¦‚ä¸‹</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;repositories&#34;</span>:<span class="o">[</span><span class="s2">&#34;busybox&#34;</span>,<span class="s2">&#34;mac_riscv64/alpine&#34;</span>,<span class="s2">&#34;riscv64/busybox&#34;</span><span class="o">]}</span>
</span></span></code></pre></div><h2 id="å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ">å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#å¤šå¹³å°æ„å»ºé€‚é…çš„é•œåƒ">#</a></h2>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆæŠ›å¼€k3s,ä½¿ç”¨dockeræ¥è¿›è¡Œç§»æ¤é€‚é…æ“ä½œï¼Œæ¯•ç«ŸäºŒè€…æ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œè€Œdockerå¯ä»¥æä¾›æ›´å¼ºå¤§çš„æ€§èƒ½ã€‚æ“ä½œæµç¨‹æ¥è‡ªäº<a href="https://docs.docker.com/build/building/multi-platform/#simple-multi-platform-build-using-emulation">Dockerå®˜æ–¹æ–‡æ¡£</a>ä¸­çš„ä½¿ç”¨QEMUè¿›è¡Œå¤šå¹³å°é•œåƒæ„å»ºæ–¹æ³•ï¼Œè¿™æ˜¯å®˜æ–¹æ–‡æ¡£ä¸­ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼Œå¸Œæœ›åé¢æˆ‘ä»¬å¯ä»¥å°è¯•å¦å¤–ä¸¤ç§æ–¹æ³•ã€‚</p>
<p>è¿™æ¬¡æˆ‘ä»¬è¦é€‚é…çš„é•œåƒæ˜¯rediså’Œnginxï¼Œæ“ä½œçš„ä¸»æœºæ˜¯Macbook M2,ä½¿ç”¨Docker Desktopæ–¹ä¾¿æ“ä½œã€‚</p>
<h3 id="æå‰é…ç½®">æå‰é…ç½®<a hidden class="anchor" aria-hidden="true" href="#æå‰é…ç½®">#</a></h3>
<p>æ ¹æ®æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä»classicé•œåƒæ¨¡å¼è½¬æ¢ä¸ºcontainerdé•œåƒæ¨¡å¼ï¼Œè¿™åœ¨Docker Desktopä¸Šå¾ˆå¥½æ“ä½œã€‚</p>
<h3 id="æ“ä½œæµç¨‹">æ“ä½œæµç¨‹<a hidden class="anchor" aria-hidden="true" href="#æ“ä½œæµç¨‹">#</a></h3>
<p>1.æ–°å»ºç›®å½•ä¿å­˜redisç­‰ä¸­é—´ä»¶çš„æºç ï¼Œä¸ºå…¶ç¼–å†™çš„Dockerfileï¼Œä»¥åŠå¯èƒ½è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶ç­‰æ–‡ä»¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p multi-platform
</span></span></code></pre></div><p>2.ä¸ºäº†é˜²æ­¢å®¹å™¨å†…éƒ¨ä¸‹è½½é€Ÿåº¦è¿‡æ…¢ï¼Œæå‰ä¸‹è½½å¥½redisçš„æºç æ–‡ä»¶å¹¶è§£å‹åˆ°æœ¬æœºã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wget https://download.redis.io/releases/redis-7.2.4.tar.gz
</span></span><span class="line"><span class="cl">tar -xzvf redis-7.2.4.tar.gz
</span></span></code></pre></div><p>3.ç¼–å†™Dockerfileæ–‡ä»¶ï¼Œè¿™é‡Œè¦æ³¨æ„æˆ‘ä»¬ä½¿ç”¨<code>alpine:latest</code>ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™ä¸ªé•œåƒæ˜¯æˆ‘å°è¯•çš„å‡ ä¸ªåŸºç¡€é•œåƒä¸­é€‚é…riscvæœ€å¥½çš„ï¼›åŒæ—¶éœ€è¦æ›¿æ¢é»˜è®¤çš„apkåŒ…é•œåƒæºï¼Œå¦åˆ™ä¼šé‡åˆ°<code>could not connect server</code>é—®é¢˜ï¼›ä¸ºäº†è®¾ç½®å¯†ç ç­‰ä¸€äº›è‡ªå®šä¹‰é…ç½®ï¼Œæˆ‘ä»¬è‡ªè¡Œç¼–å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸­<code>redis.conf</code></p>
<pre tabindex="0"><code class="language-conf" data-lang="conf"># å…è®¸æ‰€æœ‰ IP è¿æ¥ï¼ˆä¸è¦ç»‘å®š 127.0.0.1ï¼‰
bind 0.0.0.0

# å…³é—­ protected modeï¼Œå¦åˆ™å¤–éƒ¨æ— æ³•è¿æ¥
protected-mode no

# è®¾ç½®è®¿é—®å¯†ç 
requirepass password

# è®¾ç½®æŒä¹…åŒ– RDB ä¿å­˜ç­–ç•¥
save 900 1
save 300 10
save 60 10000

# RDB æ–‡ä»¶å
dbfilename dump.rdb

# RDB æ–‡ä»¶ä¿å­˜è·¯å¾„
dir ./

# æ—¥å¿—çº§åˆ«
loglevel notice

# æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆå®¹å™¨ä¸­å»ºè®®è¿™æ ·ï¼‰
logfile &#34;&#34;

# åå°è¿è¡Œï¼Œå®¹å™¨ä¸­ä¸èƒ½å¼€å¯
daemonize no

# æœ€å¤§è¿æ¥æ•°ï¼ˆå¯é€‰ï¼‰
maxclients 10000

# è®¾ç½®å†…å­˜ä¸Šé™ï¼ˆå¯é€‰ï¼‰
# maxmemory 256mb
# maxmemory-policy allkeys-lru
</code></pre><p>è¿™æ˜¯Dockerfile:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> alpine:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ›¿æ¢é»˜è®¤ apk æºä¸ºé•œåƒæº</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> sed -i <span class="s1">&#39;s#https\?://dl-cdn.alpinelinux.org/alpine#http://mirrors.aliyun.com/alpine#g&#39;</span> /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å®‰è£… Redis æ„å»ºä¾èµ–</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk update <span class="o">&amp;&amp;</span> apk add --no-cache build-base jemalloc-dev linux-headers<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´ Redis æºç ï¼ˆå‡è®¾ redis-7.2.4 æ–‡ä»¶å¤¹å’Œ Dockerfile åŒç›®å½•ï¼‰</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> redis-7.2.4 /redis<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /redis</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ç¼–è¯‘ Redis</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> make<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´é…ç½®æ–‡ä»¶</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> redis.conf /etc/redis.conf<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># è®¾ç½®é»˜è®¤å¯åŠ¨å‘½ä»¤</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;src/redis-server&#34;</span><span class="p">,</span> <span class="s2">&#34;/etc/redis.conf&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>4.æ„å»ºè·¨å¹³å°é•œåƒã€‚è¿™ä¸€æ­¥æœ¬è´¨ä¸Šç”¨åˆ°äº†buildxå’ŒQEMUï¼Œä½†æ˜¯Docker Desktopä¸ºæˆ‘ä»¬æŠŠè¿™äº›åº•å±‚éƒ½å°è£…äº†èµ·æ¥ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯ç”¨Docker Desktopå¯åŠ¨çš„Dockerå°±ä¸ç”¨åœ¨æ„;æ„å»ºçš„åŒæ—¶å¦‚æœé‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œè¯·åœ¨å‚æ•°ä¸­æ·»åŠ <code>--network host</code>å‘½ä»¤ï¼Œè¿™ä¼šå°†å®¿ä¸»æœºç½‘ç»œä½œä¸ºå®¹å™¨å†…éƒ¨ç½‘ç»œï¼Œç»•è¿‡ç½‘ç»œé™åˆ¶ã€‚è¿™ä¸ªè§£å†³æ€è·¯æ¥è‡ªäº<a href="https://stackoverflow.com/questions/53710206/docker-cant-build-because-of-alpine-error">stackoverflow</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># è¿™é‡Œæˆ‘ä»¬ç›´æ¥-tæ‰“å¥½äº†æ ‡ç­¾ï¼Œä¸ç”¨å†tagäº†</span>
</span></span><span class="line"><span class="cl">docker build --network host --platform<span class="o">=</span>linux/riscv64 -f Dockerfile.redis -t 192.168.173.76:6000/riscv64/redis:1.1 .
</span></span></code></pre></div><p>5.æ¨é€åˆ°æœ¬åœ°ç§æœ‰é•œåƒä»“åº“ä¸­ï¼Œå†ä»RiscVå¼€å‘æ¿ä¸­æ‹‰å–è¯¥é•œåƒ,è¿™ä¸€æ­¥å’Œä¸Šé¢ç§æœ‰é•œåƒä»“åº“æ„å»ºç›¸åŒã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker push 192.168.173.76:6000/riscv64/redis:1.1
</span></span><span class="line"><span class="cl"><span class="c1"># riscvä¸‹</span>
</span></span><span class="line"><span class="cl">docker pull 192.168.173.76:6000/riscv64/redis:1.1
</span></span></code></pre></div><p>6.è¿è¡Œredis-serverå®¹å™¨ï¼Œå¹¶åœ¨ä¸»æœºä¸Šè¿è¡Œredis-cliæ¥æµ‹è¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -d --name redis-test -p 6379:6379 192.168.173.76:6000/riscv64/redis:1.1
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸»æœºè¿è¡Œ</span>
</span></span><span class="line"><span class="cl">redis-cli -h &lt;riscvIP&gt; -p <span class="m">6379</span>
</span></span><span class="line"><span class="cl">&gt; AUTH password
</span></span><span class="line"><span class="cl">&gt; <span class="nb">set</span> foo bar
</span></span><span class="line"><span class="cl">&gt; get foo
</span></span></code></pre></div><p>å¾—åˆ°æœ€ç»ˆç»“æœ&quot;bar&quot;,è¯æ˜æˆ‘ä»¬æˆåŠŸäº†ï¼</p>
<p>åŒç†æˆ‘ä»¬ä¹Ÿå¯ä»¥æµ‹è¯•ä¸€ä¸‹nginxé•œåƒï¼Œä¸‹é¢æ˜¯å…¶ç®€å•çš„dockerfile</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> alpine:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ›¿æ¢æºï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥ç”¨æ¸…åæºï¼‰</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> sed -i <span class="s1">&#39;s#dl-cdn.alpinelinux.org#mirrors.aliyun.com#g&#39;</span> /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="o">&amp;&amp;</span> apk add --no-cache nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´é…ç½®æ–‡ä»¶å’Œé™æ€èµ„æº</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/nginx.conf<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> html/ /usr/share/nginx/html/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æš´éœ²ç«¯å£</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å¯åŠ¨ Nginx</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>å…¶ä¸­çš„nginx.conf</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">worker_processes 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">events <span class="o">{</span>
</span></span><span class="line"><span class="cl">    worker_connections 1024<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">http <span class="o">{</span>
</span></span><span class="line"><span class="cl">    include       mime.types<span class="p">;</span>
</span></span><span class="line"><span class="cl">    default_type  application/octet-stream<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    sendfile        on<span class="p">;</span>
</span></span><span class="line"><span class="cl">    keepalive_timeout  65<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        listen       80<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server_name  localhost<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">            root   /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">            index  index.html index.htm<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¯¹åº”çš„htmlæ–‡ä»¶å†…å®¹:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Welcome to RISC-V Nginx!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">font-family</span><span class="p">:</span> <span class="s2">&#34;Segoe UI&#34;</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">background-color</span><span class="p">:</span> <span class="mh">#f4f4f4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding-top</span><span class="p">:</span> <span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nt">h1</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">color</span><span class="p">:</span> <span class="mh">#333</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nt">p</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">color</span><span class="p">:</span> <span class="mh">#777</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nc">tag</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">display</span><span class="p">:</span> <span class="kc">inline-block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">margin-top</span><span class="p">:</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">padding</span><span class="p">:</span> <span class="mi">8</span><span class="kt">px</span> <span class="mi">16</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">background-color</span><span class="p">:</span> <span class="mh">#007acc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">color</span><span class="p">:</span> <span class="kc">white</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">border-radius</span><span class="p">:</span> <span class="mi">4</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">font-weight</span><span class="p">:</span> <span class="kc">bold</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>ğŸš€ Hello from RISC-V Nginx!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your nginx server is up and running.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;tag&#34;</span><span class="p">&gt;</span>riscv64 / alpine / nginx<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>åŒç†æ‰“åŒ…æ¨é€æ‹‰å–ã€‚è¿è¡Œå®¹å™¨åï¼Œåœ¨æˆ‘çš„macä¸»æœºä¸Šè®¿é—®<code>http://&lt;riscvIP&gt;:8080</code>å¯ä»¥çœ‹åˆ°ä¸Šè¿°htmlæ–‡ä»¶çš„æ•ˆæœ</p>
<p><img loading="lazy" src="/img/riscv/nginx01.png"></p>
<h3 id="ä¼˜åŒ–é•œåƒ">ä¼˜åŒ–é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–é•œåƒ">#</a></h3>
<p>å½“å‰redisé•œåƒå¤§å°ä¸º146MB</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> lutao@MagicTech multi-platform % docker images <span class="p">|</span> grep redis
</span></span><span class="line"><span class="cl">192.168.173.76:6000/riscv64/redis     1.1       e8e1336c3ccf   <span class="m">13</span> hours ago    146MB
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤šé˜¶æ®µæ„å»ºä»¥ç²¾ç®€æœ€ç»ˆé•œåƒï¼Œä½¿å…¶ä¸åŒ…å«æ„å»ºå·¥å…·å’Œæºä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># ---------- æ„å»ºé˜¶æ®µ ----------</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:latest AS builder</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä½¿ç”¨é˜¿é‡ŒæºåŠ é€Ÿ</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> sed -i <span class="s1">&#39;s#http.*/alpine#http://mirrors.aliyun.com/alpine#g&#39;</span> /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å®‰è£…æ„å»ºä¾èµ–</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk update <span class="o">&amp;&amp;</span> apk add --no-cache build-base jemalloc-dev linux-headers<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´æºç </span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> redis-7.2.4 /redis<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /redis</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ç¼–è¯‘ Redis</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> make<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ---------- è¿è¡Œé˜¶æ®µ ----------</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:latest</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ä½¿ç”¨é˜¿é‡Œæºï¼ˆå¯é€‰ï¼‰</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> sed -i <span class="s1">&#39;s#http.*/alpine#http://mirrors.aliyun.com/alpine#g&#39;</span> /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># å®‰è£…è¿è¡Œæ‰€éœ€çš„ jemalloc</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk add --no-cache jemalloc<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´ redis-server å’Œ redis-cliï¼ˆå¦‚æœä½ éœ€è¦ CLI å·¥å…·ï¼‰</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder /redis/src/redis-server /usr/local/bin/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder /redis/src/redis-cli /usr/local/bin/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># æ‹·è´é…ç½®æ–‡ä»¶</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> redis.conf /etc/redis.conf<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># è®¾ç½®é»˜è®¤å¯åŠ¨å‘½ä»¤</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;redis-server&#34;</span><span class="p">,</span> <span class="s2">&#34;/etc/redis.conf&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>æœ€ç»ˆæ„å»ºè¿‡ç¨‹èŠ±è´¹293.4s</p>
<p><img loading="lazy" src="/img/riscv/redis01.png"></p>
<p>æœ€ç»ˆé•œåƒå¤§å°åªæœ‰10.2MBï¼Œç›¸è¾ƒäºä¹‹å‰çš„146MBç¼©å°äº†è®¸å¤šã€‚</p>
<p><img loading="lazy" src="/img/riscv/redis02.png"></p>
<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ„å»ºä¸€ä¸ªåªæœ‰redis-cliçš„é•œåƒï¼Œå¯¹äºèåˆè¿›k3sé›†ç¾¤ä¸­æˆ–è®¸å¯ä»¥åœ¨serverèŠ‚ç‚¹ä¸Šä½¿ç”¨redis-serveré•œåƒï¼Œç„¶ååœ¨å…¶ä»–agentèŠ‚ç‚¹çš„podä¸­éƒ¨ç½²redis-cliå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“<a hidden class="anchor" aria-hidden="true" href="#æ€»ç»“">#</a></h2>
<p>æ­å»ºäº†ä¸€ä¸ªç®€æ˜“çš„ç§æœ‰é•œåƒä»“åº“å’Œç§»æ¤äº†redis-serveré•œåƒåˆ°RiscVæœºå™¨ä¸Šï¼Œç®—æ˜¯è¿ˆå‡ºäº†ä¸é”™çš„ä¸€æ­¥ï¼Œåé¢çš„å·¥ä½œä¸»è¦å›´ç»•ç€å¦‚ä½•å°†å…¶æ›´æ·±å…¥åœ°èå…¥åˆ°k3sä¸­ä»¥åŠæ·±å…¥æ¢ç©¶dockerçš„å¤šå¹³å°æ„å»ºå…¶åº•å±‚åŸç†å±•å¼€ã€‚</p>
<p><strong>è¿™é‡Œæ˜¯LTXï¼Œæ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡åšå®¢ï¼Œäººç”Ÿæµ·æµ·ï¼Œå’Œè‡ªå·±å¯¹è¯ï¼Œåƒåªè´è¶çºµæ¨ªå››æµ·ã€‚</strong></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://LTXWorld.github.io/tags/docker/">Docker</a></li>
      <li><a href="https://LTXWorld.github.io/tags/macos/">Macos</a></li>
      <li><a href="https://LTXWorld.github.io/tags/riscv/">RiscV</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://LTXWorld.github.io/posts/017macos%E7%B3%BB%E7%BB%9F%E5%8D%87%E7%BA%A7%E4%B8%8Ehomebrew%E7%9A%84%E5%85%B3%E7%B3%BB/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>DebugEP02â€”â€”MacOsç³»ç»Ÿå‡çº§ä¸Homebrewçš„å…³ç³»</span>
  </a>
  <a class="next" href="https://LTXWorld.github.io/posts/015tmux%E7%BB%88%E7%AB%AF%E7%BC%96%E8%BE%91%E5%99%A8/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>Tmuxç»ˆç«¯çª—å£å™¨</span>
  </a>
</nav>

  </footer><div id="tw-comment"></div>

<script>

    

    const getStoredTheme = () => localStorage.getItem("pref-theme") === "light" ? "light" : "dark";

    const setGiscusTheme = () => {

        const sendMessage = (message) => {

            const iframe = document.querySelector('iframe.giscus-frame');

            if (iframe) {

                iframe.contentWindow.postMessage({giscus: message}, 'https://giscus.app');

            }

        }

        sendMessage({setConfig: {theme: getStoredTheme()}})

    }


    document.addEventListener("DOMContentLoaded", () => {

        const giscusAttributes = {

            "src": "https://giscus.app/client.js",

            "data-repo": "LTXWorld\/LTXWorld.github.io",

            "data-repo-id": "R_kgDONODUuA",

            "data-category": "Announcements",

            "data-category-id": "DIC_kwDONODUuM4CkMUw",

            "data-mapping": "pathname",

            "data-strict": "0",

            "data-reactions-enabled": "1",

            "data-emit-metadata": "0",

            "data-input-position": "bottom",

            "data-theme": getStoredTheme(),

            "data-lang": "zh-CN",

            "data-loading": "lazy",

            "crossorigin": "anonymous",

        };


        

        const giscusScript = document.createElement("script");

        Object.entries(giscusAttributes).forEach(

                ([key, value]) => giscusScript.setAttribute(key, value));

        document.querySelector("#tw-comment").appendChild(giscusScript);


        

        const themeSwitcher = document.querySelector("#theme-toggle");

        if (themeSwitcher) {

            themeSwitcher.addEventListener("click", setGiscusTheme);

        }

        const themeFloatSwitcher = document.querySelector("#theme-toggle-float");

        if (themeFloatSwitcher) {

            themeFloatSwitcher.addEventListener("click", setGiscusTheme);

        }

    });

</script>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://LTXWorld.github.io/">Â©2025 LTX&rsquo;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div class="ltx-music-player" id="ltx-music-player" role="group" aria-label="èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨">
  <audio id="ltx-music-audio" preload="metadata"></audio>
  <div class="ltx-drag-handle" data-role="drag-handle" title="ä¸Šä¸‹æ‹–åŠ¨è°ƒæ•´ä½ç½®"></div>
  <div class="ltx-music-header">
    <div class="ltx-music-visual">
      <div class="ltx-disc" data-role="disc" aria-hidden="true">
        <img data-role="cover" alt="" loading="lazy" decoding="async">
        <div class="ltx-disc-center"></div>
      </div>
    </div>
    <div class="ltx-music-meta">
      <span class="ltx-music-title" data-role="title"></span>
      <span class="ltx-music-artist" data-role="artist"></span>
    </div>
    <button type="button" class="ltx-music-hide" data-action="collapse" aria-label="éšè—æ’­æ”¾å™¨">&#215;</button>
  </div>
  <div class="ltx-music-progress" data-role="progress" aria-label="è¿›åº¦æ¡" role="slider">
    <div class="ltx-music-progress-fill" data-role="progress-fill"></div>
  </div>
  <div class="ltx-music-time">
    <span data-role="current">0:00</span>
    <span data-role="total">--:--</span>
  </div>
  <div class="ltx-music-controls">
    <button type="button" data-action="prev" aria-label="ä¸Šä¸€é¦–">â®</button>
    <button type="button" data-action="toggle" aria-label="æ’­æ”¾æˆ–æš‚åœ">
      <span data-icon="play">â–¶</span>
      <span data-icon="pause">â¸</span>
    </button>
    <button type="button" data-action="next" aria-label="ä¸‹ä¸€é¦–">â­</button>
    <button type="button" data-action="mute" aria-label="é™éŸ³æˆ–å–æ¶ˆé™éŸ³">
      <span data-icon="unmuted">ğŸ”Š</span>
      <span data-icon="muted">ğŸ”‡</span>
    </button>
  </div>
  <div class="ltx-autoplay-tip" data-role="tip" aria-live="polite"></div>
</div>
<button type="button" class="ltx-music-fab" id="ltx-music-fab" aria-label="æ˜¾ç¤ºéŸ³ä¹æ’­æ”¾å™¨">&#9835;</button>
<script>
  window.LTX_MUSIC_CONFIG = {"autoplay":true,"defaultCover":"","loopPlaylist":true,"startVolume":0.6,"tracks":[{"artist":"ç‹åŠ›å®","file":"/audio/02 - ä¾ç„¶çˆ±ä½ .mp3","title":"ä¾ç„¶çˆ±ä½ "},{"artist":"ç‹åŠ›å®","file":"/audio/05 - æ”¹å˜è‡ªå·±.mp3","title":"æ”¹å˜è‡ªå·±"},{"artist":"ç‹åŠ›å®","file":"/audio/11 - çˆ±é”™.mp3","title":"çˆ±é”™"}]};
  (function () {
    const config = window.LTX_MUSIC_CONFIG || {};
    if (!config.tracks || !config.tracks.length) {
      return;
    }

    const player = document.getElementById('ltx-music-player');
    const audio = player.querySelector('audio');
    const titleEl = player.querySelector('[data-role="title"]');
    const artistEl = player.querySelector('[data-role="artist"]');
    const progressEl = player.querySelector('[data-role="progress"]');
    const progressFillEl = player.querySelector('[data-role="progress-fill"]');
    const currentTimeEl = player.querySelector('[data-role="current"]');
    const totalTimeEl = player.querySelector('[data-role="total"]');
    const tipEl = player.querySelector('[data-role="tip"]');
    const coverEl = player.querySelector('[data-role="cover"]');

    const toggleBtn = player.querySelector('[data-action="toggle"]');
    const prevBtn = player.querySelector('[data-action="prev"]');
    const nextBtn = player.querySelector('[data-action="next"]');
    const muteBtn = player.querySelector('[data-action="mute"]');
    const collapseBtn = player.querySelector('[data-action="collapse"]');
    const dragHandle = player.querySelector('[data-role="drag-handle"]');
    const fabButton = document.getElementById('ltx-music-fab');

    const clamp = (value, min, max) => Math.min(Math.max(value, min), max);
    const formatTime = (seconds) => {
      if (!Number.isFinite(seconds)) {
        return '--:--';
      }
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${String(mins).padStart(1, '0')}:${String(secs).padStart(2, '0')}`;
    };

    const minOffset = -120;
    const maxOffset = 220;
    const hideThreshold = 180;
    const dragState = { active: false, startY: 0, startOffset: 0, pointerId: null };
    const storageKey = 'ltx-music-player-state';

    const safeStorage = (() => {
      try {
        const probeKey = '__ltx_music_probe__';
        window.localStorage.setItem(probeKey, probeKey);
        window.localStorage.removeItem(probeKey);
        return window.localStorage;
      } catch (err) {
        console.warn('LTX music player: localStorage ä¸å¯ç”¨', err);
        return null;
      }
    })();

    const loadPersistedState = () => {
      if (!safeStorage) {
        return null;
      }
      try {
        const raw = safeStorage.getItem(storageKey);
        return raw ? JSON.parse(raw) : null;
      } catch (err) {
        console.warn('LTX music player: è¯»å–å†å²æ’­æ”¾çŠ¶æ€å¤±è´¥', err);
        return null;
      }
    };

    const normalizeIndex = (index, total) => {
      if (!Number.isInteger(index) || !total) {
        return 0;
      }
      return ((index % total) + total) % total;
    };

    const savedState = loadPersistedState();

    const state = {
      index: 0,
      tracks: config.tracks,
      autoplay: config.autoplay !== false,
      loopPlaylist: config.loopPlaylist !== false,
      offset: 0,
      collapsed: false,
    };

    if (savedState) {
      if (state.tracks.length && Number.isInteger(savedState.trackIndex)) {
        state.index = normalizeIndex(savedState.trackIndex, state.tracks.length);
      }
      if (Number.isFinite(savedState.offset)) {
        state.offset = clamp(savedState.offset, minOffset, maxOffset);
      }
      if (typeof savedState.collapsed === 'boolean') {
        state.collapsed = savedState.collapsed;
      }
    }

    let lastPersistAt = 0;
    const persistState = (overrides = {}, immediate = false) => {
      if (!safeStorage) {
        return;
      }
      const snapshot = {
        trackIndex: state.index,
        currentTime: audio.currentTime || 0,
        isPlaying: !audio.paused,
        volume: audio.volume,
        muted: audio.muted,
        collapsed: state.collapsed,
        offset: state.offset,
        ...overrides,
      };
      const now = Date.now();
      if (!immediate && now - lastPersistAt < 800) {
        return;
      }
      lastPersistAt = now;
      try {
        safeStorage.setItem(storageKey, JSON.stringify(snapshot));
      } catch (err) {
        console.warn('LTX music player: ä¿å­˜æ’­æ”¾çŠ¶æ€å¤±è´¥', err);
      }
    };

    const flushState = (overrides = {}) => persistState(overrides, true);

    const setOffset = (value, options = {}) => {
      state.offset = clamp(value, minOffset, maxOffset);
      player.style.setProperty('--ltx-offset', `${state.offset}px`);
      if (!options.silent) {
        persistState({ offset: state.offset });
      }
    };

    const setCollapsed = (value, options = {}) => {
      const collapsed = Boolean(value);
      state.collapsed = collapsed;
      player.classList.toggle('ltx-collapsed', collapsed);
      if (collapsed) {
        player.classList.remove('ltx-dragging');
        state.offset = 0;
        player.style.removeProperty('--ltx-offset');
        if (fabButton) {
          fabButton.classList.add('ltx-visible');
          fabButton.setAttribute('aria-hidden', 'false');
          fabButton.tabIndex = 0;
        }
      } else {
        setOffset(0);
        if (fabButton) {
          fabButton.classList.remove('ltx-visible');
          fabButton.setAttribute('aria-hidden', 'true');
          fabButton.tabIndex = -1;
        }
      }
      if (!options.silent) {
        persistState({ collapsed }, true);
      }
    };

    const updateMuteClass = () => {
      const muted = audio.muted || audio.volume === 0;
      player.classList.toggle('ltx-muted', muted);
    };

    const hasSavedVolume = savedState && Number.isFinite(savedState.volume);
    const initialVolume = hasSavedVolume ? clamp(savedState.volume, 0, 1) : clamp(config.startVolume ?? 0.6, 0, 1);
    audio.volume = initialVolume;
    if (savedState && typeof savedState.muted === 'boolean') {
      audio.muted = savedState.muted;
    }
    updateMuteClass();

    const updateProgress = () => {
      const duration = audio.duration || 0;
      const current = audio.currentTime || 0;
      const percentage = duration ? (current / duration) * 100 : 0;
      progressFillEl.style.width = `${percentage}%`;
      currentTimeEl.textContent = formatTime(current);
      totalTimeEl.textContent = formatTime(duration);
    };

    const seekWhenReady = (time) => {
      const target = Number.isFinite(time) ? Math.max(0, time) : 0;
      if (!target) {
        audio.currentTime = 0;
        flushState({ currentTime: 0 });
        updateProgress();
        return;
      }
      const assign = () => {
        const duration = audio.duration;
        const upper = Number.isFinite(duration) && duration > 0 ? Math.min(target, duration) : target;
        try {
          audio.currentTime = upper;
          updateProgress();
          flushState({ currentTime: upper });
        } catch (err) {
           
        }
      };
      if (audio.readyState >= 1) {
        assign();
      } else {
        const handler = () => {
          assign();
          audio.removeEventListener('loadedmetadata', handler);
          audio.removeEventListener('canplay', handler);
        };
        audio.addEventListener('loadedmetadata', handler);
        audio.addEventListener('canplay', handler);
      }
    };

    const setTrack = (nextIndex, options = {}) => {
      const total = state.tracks.length;
      state.index = ((nextIndex % total) + total) % total;
      const track = state.tracks[state.index];
      if (!track || !track.file) {
        console.warn('LTX music player: éŸ³é¢‘æ–‡ä»¶ç¼ºå¤±', track);
        tipEl.textContent = 'éŸ³é¢‘æ–‡ä»¶ç¼ºå¤±ï¼Œè¯·æ£€æŸ¥é…ç½®';
        return;
      }
      const cover = track.cover || config.defaultCover || '';
      if (coverEl) {
        if (cover) {
          coverEl.src = cover;
          coverEl.alt = track.title ? `${track.title} å°é¢` : 'éŸ³ä¹å°é¢';
          player.classList.add('ltx-has-cover');
        } else {
          coverEl.removeAttribute('src');
          coverEl.alt = '';
          player.classList.remove('ltx-has-cover');
        }
      }
      titleEl.textContent = track.title || `Track ${state.index + 1}`;
      artistEl.textContent = track.artist || '';
      audio.src = track.file;
      player.dataset.trackIndex = state.index;
      tipEl.textContent = '';
      player.classList.remove('ltx-autoplay-blocked');
      seekWhenReady(options.resumeTime);
      flushState({
        trackIndex: state.index,
        currentTime: Number.isFinite(options.resumeTime) ? Math.max(0, options.resumeTime) : 0,
      });
      updateProgress();
      if (options.play) {
        attemptPlay();
      }
    };

    const attemptPlay = () => {
      audio.play().then(() => {
        player.classList.remove('ltx-autoplay-blocked');
        tipEl.textContent = '';
      }).catch(() => {
        player.classList.add('ltx-autoplay-blocked');
        tipEl.textContent = 'æµè§ˆå™¨é˜»æ­¢äº†è‡ªåŠ¨æ’­æ”¾ï¼Œè¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®';
      });
    };

    const playNext = (autoTriggered = false) => {
      const shouldPlay = !audio.paused || autoTriggered;
      const nextIndex = state.index + 1;
      if (nextIndex >= state.tracks.length && !state.loopPlaylist) {
        audio.currentTime = audio.duration || 0;
        audio.pause();
        flushState();
        return;
      }
      setTrack(nextIndex, { play: shouldPlay });
    };

    const playPrev = () => {
      const shouldPlay = !audio.paused;
      setTrack(state.index - 1, { play: shouldPlay });
    };

    if (state.collapsed) {
      setCollapsed(true, { silent: true });
    } else {
      setOffset(state.offset, { silent: true });
    }

    if (collapseBtn) {
      collapseBtn.addEventListener('click', () => setCollapsed(true));
    }

    if (fabButton) {
      fabButton.addEventListener('click', () => setCollapsed(false));
      if (state.collapsed) {
        fabButton.classList.add('ltx-visible');
        fabButton.setAttribute('aria-hidden', 'false');
        fabButton.tabIndex = 0;
      } else {
        fabButton.setAttribute('aria-hidden', 'true');
        fabButton.tabIndex = -1;
      }
    }

    if (dragHandle) {
      dragHandle.style.touchAction = 'none';
      dragHandle.addEventListener('pointerdown', (event) => {
        if (state.collapsed) {
          return;
        }
        dragState.active = true;
        dragState.pointerId = event.pointerId;
        dragState.startY = event.clientY;
        dragState.startOffset = state.offset;
        if (dragHandle.setPointerCapture) {
          try {
            dragHandle.setPointerCapture(event.pointerId);
          } catch (err) {
             
          }
        }
        player.classList.add('ltx-dragging');
      });

      dragHandle.addEventListener('pointermove', (event) => {
        if (!dragState.active) {
          return;
        }
        const delta = event.clientY - dragState.startY;
        setOffset(dragState.startOffset + delta);
      });

      const finishDrag = () => {
        if (!dragState.active) {
          return;
        }
        if (dragState.pointerId !== null && dragHandle.releasePointerCapture) {
          try {
            dragHandle.releasePointerCapture(dragState.pointerId);
          } catch (err) {
             
          }
        }
        dragState.active = false;
        dragState.pointerId = null;
        player.classList.remove('ltx-dragging');
        if (state.offset > hideThreshold) {
          setCollapsed(true);
        } else {
          setOffset(state.offset);
        }
      };

      ['pointerup', 'pointercancel'].forEach((eventName) => {
        dragHandle.addEventListener(eventName, finishDrag);
      });

      dragHandle.addEventListener('pointerleave', () => {
        if (!dragState.active) {
          return;
        }
        finishDrag();
      });
    }

    toggleBtn.addEventListener('click', () => {
      if (audio.paused) {
        attemptPlay();
      } else {
        audio.pause();
      }
    });

    prevBtn.addEventListener('click', playPrev);
    nextBtn.addEventListener('click', () => playNext(false));

    muteBtn.addEventListener('click', () => {
      audio.muted = !audio.muted;
      updateMuteClass();
    });

    progressEl.addEventListener('click', (event) => {
      const rect = progressEl.getBoundingClientRect();
      const ratio = clamp((event.clientX - rect.left) / rect.width, 0, 1);
      if (Number.isFinite(audio.duration)) {
        audio.currentTime = ratio * audio.duration;
        flushState();
      }
    });

    audio.addEventListener('timeupdate', () => {
      updateProgress();
      persistState();
    });
    audio.addEventListener('loadedmetadata', () => {
      updateProgress();
      persistState();
    });

    audio.addEventListener('play', () => {
      player.classList.add('ltx-playing');
      player.classList.remove('ltx-autoplay-blocked');
      tipEl.textContent = '';
      flushState();
    });

    audio.addEventListener('pause', () => {
      player.classList.remove('ltx-playing');
      flushState();
    });

    audio.addEventListener('ended', () => {
      playNext(true);
    });

    audio.addEventListener('volumechange', () => {
      updateMuteClass();
      flushState();
    });
    audio.addEventListener('seeked', () => {
      flushState();
    });

    const handleVisibilityChange = () => {
      if (document.visibilityState === 'hidden') {
        flushState();
      }
    };

    window.addEventListener('pagehide', () => flushState());
    window.addEventListener('beforeunload', () => flushState());
    document.addEventListener('visibilitychange', handleVisibilityChange);

    const initialResumeTime = savedState && Number.isFinite(savedState.currentTime) ? Math.max(0, savedState.currentTime) : 0;
    const initialShouldPlay = savedState ? savedState.isPlaying === true : state.autoplay;
    setTrack(state.index, { play: initialShouldPlay, resumeTime: initialResumeTime });
  })();
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'å¤åˆ¶';

        function copyingDone() {
            copybutton.innerHTML = 'å·²å¤åˆ¶ï¼';
            setTimeout(() => {
                copybutton.innerHTML = 'å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
