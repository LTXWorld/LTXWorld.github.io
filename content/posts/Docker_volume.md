+++
date = '2024-11-18T18:49:09+08:00'
title = '玩转Docker系列——volume'
categories = ["核心技术"]
tags = ["容器","docker"]
+++

# Docker_Volumes

![](/img/ys/晚上好兄弟们.jpg)

大家好我是LTX，我猜在使用docker时你或多或少都会有疑问，我的数据被存到哪里去了？（什么?你不用docker?，滚出克😡）docker化之后为什么得到的镜像这么小，比我原始的程序要小这么多？特别是如果我将Mysql容器化，那它保存的记录都去哪里了？

今天我将进入Docker_Volumes的世界，与大家聊聊Docker是如何处理数据持久化的。

秉持着STFW&RTFM的精神，我从[官方的手册](https://docs.docker.com/engine/storage/)看起，并且辅助以测试实验来验证手册中的理论，设计实验部分使用了部分AI工具辅助。

本机环境:macos15.1，Docker version 27.2.0, build 3ab4256

## Storage

手册中一开始就说明了默认情况下，容器内部创建的所有文件都存储在可写容器层上(详见docker基础原理)，这意味着，**当该容器不存在时，数据不会持久化。**

那不会持久化可不行啊，我MYSQL关键点之一就是持久化啊，另一个容器要用我的数据结果你取不出来锁在容器里面了，这两个容器交互不就完犊子了吗？不行不行，得有个办法来实现数据的持久化，要不然我docker还怎么立足于容器生态江湖。

并且更蛋疼的是容器的可写层与运行容器的主机紧密耦合，难以轻易地将数据移动到其他地方。*这是因为可写层是容器运行时基于主机环境创建的一种临时存储结构，它的存在依赖于容器的运行状态，不像独立于容器的存储机制那样便于迁移数据。*

其实就是docker底层需要一个虚拟机运行嘛(见docker基础原理)，我们在主机上当然无法直接访问这个虚拟机，那我数据呢!?我想要让其他的人也用用啊！

![](/img/ys/你说什么.webp)

docker设计者也当然为我想到了这种情况，于是他提供了两种解决方法：

* 数据持久化到主机的磁盘上
* 数据持久化到主机的内存中

嘿，怎么有点Mysql的感觉了？扯远了，第一种解决方法又详细地分为了卷挂载和绑定挂载，至于这三者有何区别，且看手册中这张图片：
![](/img/docker/volume1.png)

哈哈，你以为我要开始长篇大论了，别急，让我们先对这张图片有个印象就好，观察到三者的不同就行，我先得设计个实验来验证上面的默认不可持久化！

## lib01

首先，打开终端，(其实docker也提供了非常好用的GUI但我就想用Terminal)，运行一个简单的容器命名为test1,并进入到其中。

```bash
docker run -it --name test1 ubuntu:latest bash
```

在容器内部执行命令新建文件并写入测试内容作为测试数据。

```bash
echo "Test data in container layer" > /test_file.txt
```

检查内容是否成功写入并退出容器。

```bash
cat /test_file.txt
exit
```

使用同一个镜像来新建另一个容器，重复上述步骤查看指定文件是否存在

```bash
docker run -it --name test2 ubuntu:latest bash
ls | grep test_file.txt
```

发现并不存在这个文件，证明当容器不存在时，在可写容器层创建的文件数据不会持久保存。