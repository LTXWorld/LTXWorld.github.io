+++
date = '2025-08-11T18:45:25+08:00'
draft = true
title = '048跟着AI学习计算机网络'
+++

## 引子


## 记录

### TCP握手挥手过程

`sudo tcpdump -i lo -S -v tcp port 7070`

`sudo tcpdump -i lo -S -v tcp port 7070`

`curl http://127.0.0.1:7070`

```bash
sudo tcpdump -i lo -S -v tcp port 7070
tcpdump: listening on lo, link-type EN10MB (Ethernet), snapshot length 262144 bytes
18:39:31.097639 IP (tos 0x0, ttl 64, id 19239, offset 0, flags [DF], proto TCP (6), length 60)
    localhost.46136 > localhost.7070: Flags [S], cksum 0xfe30 (incorrect -> 0xe79e), seq 3564383388, win 65495, options [mss 65495,sackOK,TS val 3523724659 ecr 0,nop,wscale 7], length 0
18:39:31.097671 IP (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    localhost.7070 > localhost.46136: Flags [S.], cksum 0xfe30 (incorrect -> 0xa381), seq 2807956798, ack 3564383389, win 65483, options [mss 65495,sackOK,TS val 3523724659 ecr 3523724659,nop,wscale 7], length 0
18:39:31.097702 IP (tos 0x0, ttl 64, id 19240, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.46136 > localhost.7070: Flags [.], cksum 0xfe28 (incorrect -> 0xca3d), ack 2807956799, win 512, options [nop,nop,TS val 3523724659 ecr 3523724659], length 0
18:39:31.097927 IP (tos 0x0, ttl 64, id 19241, offset 0, flags [DF], proto TCP (6), length 129)
    localhost.46136 > localhost.7070: Flags [P.], cksum 0xfe75 (incorrect -> 0x6e9b), seq 3564383389:3564383466, ack 2807956799, win 512, options [nop,nop,TS val 3523724659 ecr 3523724659], length 77
18:39:31.097956 IP (tos 0x0, ttl 64, id 46227, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.7070 > localhost.46136: Flags [.], cksum 0xfe28 (incorrect -> 0xc9f1), ack 3564383466, win 511, options [nop,nop,TS val 3523724659 ecr 3523724659], length 0
18:40:32.082157 IP (tos 0x0, ttl 64, id 19242, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.46136 > localhost.7070: Flags [.], cksum 0xfe28 (incorrect -> 0xdbb7), ack 2807956799, win 512, options [nop,nop,TS val 3523785644 ecr 3523724659], length 0
18:40:32.082178 IP (tos 0x0, ttl 64, id 46228, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.7070 > localhost.46136: Flags [.], cksum 0xfe28 (incorrect -> 0xdbb6), ack 3564383466, win 512, options [nop,nop,TS val 3523785644 ecr 3523724659], length 0
18:41:33.523205 IP (tos 0x0, ttl 64, id 19243, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.46136 > localhost.7070: Flags [.], cksum 0xfe28 (incorrect -> 0xfd7b), ack 2807956799, win 512, options [nop,nop,TS val 3523847085 ecr 3523785644], length 0
18:41:33.523229 IP (tos 0x0, ttl 64, id 46229, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.7070 > localhost.46136: Flags [.], cksum 0xfe28 (incorrect -> 0xebb4), ack 3564383466, win 512, options [nop,nop,TS val 3523847085 ecr 3523724659], length 0
18:41:35.723669 IP (tos 0x0, ttl 64, id 19244, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.46136 > localhost.7070: Flags [F.], cksum 0xfe28 (incorrect -> 0x04e0), seq 3564383466, ack 2807956799, win 512, options [nop,nop,TS val 3523849285 ecr 3523847085], length 0
18:41:35.723808 IP (tos 0x0, ttl 64, id 46230, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.7070 > localhost.46136: Flags [F.], cksum 0xfe28 (incorrect -> 0xfc46), seq 2807956799, ack 3564383467, win 512, options [nop,nop,TS val 3523849285 ecr 3523849285], length 0
18:41:35.723868 IP (tos 0x0, ttl 64, id 19245, offset 0, flags [DF], proto TCP (6), length 52)
    localhost.46136 > localhost.7070: Flags [.], cksum 0xfe28 (incorrect -> 0xfc46), ack 2807956800, win 512, options [nop,nop,TS val 3523849285 ecr 3523849285], length 0
^C
12 packets captured
24 packets received by filter
0 packets dropped by kernel
```

这是一次抓包所产生的结果，分析如下：

三次握手：

- `Flags [S]` 代表着 SYN，请求建立连接，第一次握手
- `Flags [S.]`多了一个.,这个点就是 ACK 的简写，表示 SYN+ACK,第二次握手；且注意 `ack= seq+1`
- `Flags [.]`只有 ACK 的确认报文，第三次握手

传输数据：

- `Flags [P.]`代表 Push，`seq x:y`从x 开始到 y 长度为 77 字节数据
- 之后服务器回复 ACK 确认，等于y 表示完美匹配

Keep Alive:

- 定时发送一些空的 ACK 包探测包，确认在线

四次挥手:

- `Flags[F.]` 代表着 Fin，第一次挥手
- 当服务端也没有数据要发送时，可以直接把 ACK 和 FIN 一起发出去，合并了二三次挥手
- 第四次挥手结束

### 

## HTTPS过程

在服务端显式:

1. Certificate chain：服务器发来的证书链
2. Server certificate: 证书详细内容（server.crt)
3. SSL-session
   1. Protocal:TLSv1.3
   2. Cipher:协商的加密套件 AES
   3. Session-ID



Broker(Server):

- initial high watermark 0
- high watermark 17